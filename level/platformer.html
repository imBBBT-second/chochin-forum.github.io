<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>초친 포럼 (레벨 - 플랫포머)</title>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        background: #323232;
        display: flex;
        flex-direction: column;
        overflow-x: hidden;
      }
      * {
        box-sizing: border-box;
      }

      /* [수정] 모든 링크의 파란색 밑줄 제거 */
      a {
        color: inherit;
        text-decoration: none;
      }

      @font-face {
        font-family: Paperlogy1;
        src: url('font - paperlogy/Paperlogy-1.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy2;
        src: url('font - paperlogy/Paperlogy-2.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy3;
        src: url('font - paperlogy/Paperlogy-3.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy4;
        src: url('font - paperlogy/Paperlogy-4.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy5;
        src: url('font - paperlogy/Paperlogy-5.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy6;
        src: url('font - paperlogy/Paperlogy-6.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy7;
        src: url('font - paperlogy/Paperlogy-7.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy8;
        src: url('font - paperlogy/Paperlogy-8.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy9;
        src: url('font - paperlogy/Paperlogy-9.ttf');
        font-display: swap;
      }

      h1 {
        font-family: Paperlogy7;
        color: white;
        font-size: 170px;
        text-align: center;
      }
      h4 {
        font-family: Paperlogy3;
        color: #a0a0a0;
        text-align: center;
      }
      p,
      span {
        font-family: Paperlogy2;
        color: #c8c8c8;
      }

      /* --- 계정 바 스타일 --- */
      .auth-bar {
        background: #202020;
        padding: 10px 20px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 15px;
        border-bottom: 2px solid #444;
      }
      .user-status {
        color: #4f9;
        font-family: Paperlogy5;
        font-size: 0.95rem;
      }
      .auth-btn {
        background: transparent;
        border: 1.5px solid #fff;
        color: #fff;
        padding: 5px 15px;
        border-radius: 5px;
        font-family: Paperlogy7;
        cursor: pointer;
        transition: 0.2s;
      }
      .auth-btn:hover {
        background: #fff;
        color: #000;
      }

      .header-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5vw;
        padding: 2vh 0;
        flex-wrap: wrap;
      }

      .header-btn-wrapper {
        width: min(400px, 90vw);
        display: flex;
        justify-content: center;
      }

      .header-btn {
        background-color: #323232;
        color: white;
        font-size: clamp(1.5rem, 4vw, 3rem);
        cursor: pointer;
        padding: 1.5vh 0;
        border: none;
        border-radius: 10px;
        width: 100%;
        transition:
          background-color 0.25s ease,
          color 0.25s ease;
        font-family: Paperlogy5;
      }

      .header-btn:hover,
      .header-btn.active {
        background-color: #fff;
        color: #323232;
      }

      .divider {
        border: 2px solid white;
        width: 100%;
        height: 0;
        margin: 6px 0;
      }

      .hamburger {
        display: none;
        font-size: 2.5rem;
        color: white;
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
      }
      .header-container.open .header-btn-wrapper {
        display: flex;
      }

      .main-container {
        flex: 1;
        display: flex;
        gap: 2%;
        padding: 1.2%;
        min-height: 1000px;
      }

      .container,
      .detail-panel,
      .detail-panel.clears-panel {
        min-height: 900px;
      }

      .container,
      .detail-panel.clears-panel {
        background: #404040;
        border-radius: 10px;
        padding: 1.5%;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .container {
        flex: 0 0 25%;
        max-width: 25%;
      }

      .detail-panel {
        flex: 0 0 50%;
        max-width: 50%;
      }

      .detail-panel.clears-panel {
        flex: 0 0 25%;
        max-width: 25%;
      }

      .history-panel {
        width: calc(100% - 40px);
        margin: 0 auto 40px auto;
        background: #3a3a3a;
        border-radius: 10px;
        padding: 20px;
        min-height: 450px;
      }

      @media (max-width: 1400px) {
        .main-container {
          flex-direction: column;
          min-height: auto;
        }

        .container,
        .detail-panel,
        .detail-panel.clears-panel {
          flex: 0 0 auto;
          max-width: 100%;
          min-height: auto;
        }

        .container {
          order: 1;
          min-height: 400px;
        }

        .detail-panel {
          order: 2;
          min-height: 800px;
        }

        .detail-panel.clears-panel {
          order: 3;
          min-height: 400px;
        }
      }

      /* --- 검색 및 태그 --- */
      input#search {
        font-size: 18px;
        border-radius: 8px;
        border: none;
        padding: 12px;
        margin-bottom: 10px;
        width: 100%;
        font-family: Paperlogy5;
        background: #333;
        color: white;
      }

      #tagCategoryContainer {
        margin-bottom: 15px;
        background: #383838;
        padding: 10px;
        border-radius: 8px;
      }
      .tag-cat-row {
        display: flex;
        margin-bottom: 6px;
        align-items: flex-start;
      }
      .tag-cat-name {
        color: #aaa;
        font-family: Paperlogy6;
        font-size: 0.85rem;
        width: 50px;
        margin-top: 4px;
        flex-shrink: 0;
      }
      .tag-cat-list {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        flex: 1;
      }
      .filter-tag-btn {
        background: #555;
        color: #ddd;
        border: none;
        padding: 3px 8px;
        border-radius: 12px;
        font-family: Paperlogy4;
        font-size: 0.8rem;
        cursor: pointer;
        transition: transform 0.2s ease;
      }
      .filter-tag-btn:hover,
      .filter-tag-btn.active {
        background: #fff;
        color: #000;
      }

      .item {
        display: flex;
        padding: 0.9rem 0.5rem;
        gap: 0.8rem;
        border-bottom: 1px solid #777;
        cursor: pointer;
        transition:
          background-color 0.15s ease,
          color 0.15s ease;
        min-height: fit-content;
      }

      .rank {
        font-family: Paperlogy9;
        font-size: clamp(2rem, 3.2vw, 3.2rem);
        width: clamp(2rem, 3.2vw, 3.2rem);
        text-align: center;
        color: #ffffff;
      }

      .title {
        font-family: Paperlogy7;
        font-size: clamp(1.4rem, 2.4vw, 2.4rem);
        line-height: 1.3;
        color: #ffffff;
      }

      .creator {
        font-family: Paperlogy4;
        font-size: clamp(0.8rem, 1vw, 1rem);
        color: #d0d0d0;
      }

      .item:hover {
        background-color: #ffffff;
      }

      .item:hover .title,
      .item:hover .creator,
      .item:hover .rank {
        color: #000000;
      }

      .item.active {
        background-color: #ffffff;
      }

      .item.active .title,
      .item.active .creator,
      .item.active .rank {
        color: #000000;
      }

      .item.cleared {
        background-color: #2e4a2e !important;
        border-left: 6px solid #4f9;
      }
      .item.cleared:hover {
        background-color: #3e5a3e !important;
      }
      .item.cleared.active {
        background-color: #fff !important;
      }

      .clear-check {
        color: #4f9;
        margin-left: 8px;
        font-size: 1.2rem;
      }

      .detail-panel {
        flex: 1;
        background: #505050;
        border-radius: 10px;
        padding: 1.5%;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .detail-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        margin-bottom: 10px;
      }

      #detailCreator {
        font-family: Paperlogy4;
        font-size: clamp(1rem, 1.6vw, 1.6rem);
        color: #c8c8c8;
        margin-top: 4px;
      }

      .detail-title {
        font-family: Paperlogy9;
        font-size: clamp(2.4rem, 4.8vw, 4.8rem);
        color: #ffffff;
        line-height: 1.1;
        text-align: center;
        white-space: normal;
        word-break: keep-all;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 6px;
      }

      .video-wrapper {
        position: relative;
        width: 100%;
        padding-top: 56.25%;
        background: #000;
        border-radius: 10px;
        overflow: hidden;
      }

      .video-wrapper iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: none;
      }

      .section {
        background: #444;
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
      }

      .section-title {
        font-family: Paperlogy6;
        font-size: 22px;
        color: #fff;
        margin-bottom: 8px;
      }

      .section p {
        color: #c8c8c8;
        font-family: Paperlogy3;
        font-size: 1rem;
      }

      #list {
        flex: 1;
        overflow-y: auto;
      }

      .detail-content {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .info-section,
      .graph-section,
      .tag-section {
        background: #444;
        padding: 14px;
        border-radius: 10px;
      }

      .info-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        font-family: Paperlogy3;
        font-size: 1rem;
        color: #c8c8c8;
      }

      .info-row span {
        min-width: 45%;
      }

      .fp-warning {
        text-align: center;
        font-family: Paperlogy2;
        font-size: 0.9rem;
        color: #aaa;
        margin-top: 10px;
      }

      .graph-box {
        margin-bottom: 14px;
      }

      .graph-title {
        font-family: Paperlogy6;
        font-size: 1.2rem;
        color: #fff;
        margin-bottom: 6px;
      }

      .graph-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 4px 0;
      }

      .graph-label {
        width: 90px;
        font-family: Paperlogy3;
        font-size: 0.9rem;
        color: #c8c8c8;
        flex-shrink: 0;
      }

      .graph-bar-bg {
        flex: 1;
        background: #333;
        border-radius: 6px;
        overflow: hidden;
        height: 16px;
      }

      .graph-bar {
        height: 100%;
        border-radius: 6px;
      }

      .graph-value {
        width: 50px;
        text-align: right;
        font-family: Paperlogy4;
        font-size: 0.9rem;
        color: #c8c8c8;
      }

      .graph-total {
        margin-left: 8px;
        font-size: 0.85rem;
        color: #ccc;
        font-family: Paperlogy3;
      }

      .graph-bar[data-key='Cube'] {
        background: #00ff00;
      }
      .graph-bar[data-key='Ship'] {
        background: #ff00ff;
      }
      .graph-bar[data-key='Ball'] {
        background: #ff0000;
      }
      .graph-bar[data-key='UFO'] {
        background: #ff9900;
      }
      .graph-bar[data-key='Wave'] {
        background: #66ccff;
      }
      .graph-bar[data-key='Robot'] {
        background: #ffffff;
      }
      .graph-bar[data-key='Spider'] {
        background: #9900ff;
      }
      .graph-bar[data-key='Swing'] {
        background: #ffff00;
      }
      .graph-bar[data-key='0.5x'] {
        background: #ffff00;
      }
      .graph-bar[data-key='1x'] {
        background: #66ccff;
      }
      .graph-bar[data-key='2x'] {
        background: #00ff00;
      }
      .graph-bar[data-key='3x'] {
        background: #ff66cc;
      }
      .graph-bar[data-key='4x'] {
        background: #ff0000;
      }
      .graph-bar[data-key='30'] {
        background: #66ccff;
      }
      .graph-bar[data-key='60'] {
        background: #00ff00;
      }
      .graph-bar[data-key='120'] {
        background: #ffff00;
      }
      .graph-bar[data-key='240'] {
        background: #ff0000;
      }
      .graph-bar[data-key='120'] {
        background: #ff00ff;
      }

      /* 태그 */
      .tag-group-container {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 4px;
      }
      .tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #5f5f5f;
        color: #ffffff;
        font-family: Paperlogy4;
        font-size: 1rem;
        padding: 6px 14px;
        border-radius: 12px;
        margin: 4px 6px 4px 0;
        cursor: pointer;
        transition: 0.2s;
      }
      .tag:hover {
        background: #888;
        color: #fff;
      }

      .clears-panel {
        color: #e0e0e0;
      }

      .clear-row {
        display: flex;
        align-items: center;
        gap: 0.6vw;
        padding: 6px 4px;
        font-family: Paperlogy3;
        font-size: clamp(0.9rem, 1.1vw, 1.1vw);
        color: #e0e0e0;
      }

      .clear-rank {
        font-family: Paperlogy6;
        color: #ffffff;
        min-width: 30px;
      }

      .clear-player {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #ffffff;
        font-family: Paperlogy5;
      }

      .clear-date {
        font-family: Paperlogy2;
        font-size: 0.8rem;
        color: #b0b0b0;
      }

      .clear-percent {
        color: #c8c8c8;
        min-width: 50px;
        text-align: right;
      }
      .clear-percent.full {
        color: #ffcc00;
        font-family: Paperlogy6;
      }

      #detailHeader {
        text-align: center;
        margin-bottom: 64px;
      }

      #headerTitle {
        font-family: Paperlogy7;
        font-size: clamp(80px, 10vw, 170px);
        color: #fff;
        text-align: center;
        margin: 20px 0;
      }

      #detailSubtitle {
        margin-top: 4px;
        color: #aaa;
        font-family: Paperlogy3;
        font-size: clamp(22px, 2.8vw, 32px);
      }

      #modeShortcut {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
        margin-bottom: 18px;
      }

      .mode-btn {
        background: transparent;
        border: 1.5px solid #fff;
        color: #fff;
        padding: 6px 16px;
        border-radius: 999px;
        font-family: Paperlogy7;
        font-size: clamp(1.2rem, 3vw, 2rem);
        font-weight: 500;
        cursor: pointer;
        transition:
          background 0.2s,
          color 0.2s;
      }

      @media (max-width: 768px) {
        .mode-btn {
          font-size: clamp(1rem, 2.5vw, 1.5rem);
          padding: 4px 12px;
        }

        #modeShortcut {
          gap: 6px;
        }

        .clears-panel > div:first-child {
          font-size: clamp(1.8rem, 3.2vw, 3.2rem) !important;
        }

        .main-container {
          padding: 10px;
          gap: 15px;
        }
        .container,
        .detail-panel,
        .detail-panel.clears-panel {
          padding: 15px;
        }
        #detailHeader {
          margin-bottom: 30px;
        }
        #headerTitle {
          font-size: 100px;
        }
        #detailSubtitle {
          font-size: 20px;
        }
        .detail-title {
          font-size: 2.8rem;
          word-break: keep-all;
        }
        .header-container {
          flex-direction: column;
          gap: 10px;
        }
        .header-btn-wrapper {
          display: none;
        }
        .hamburger {
          display: block;
        }
      }

      #modeShortcut .mode {
        color: #aaa;
        text-decoration: none;
        cursor: pointer;
        font-family: Paperlogy7;
        font-size: 64px;
      }

      #modeShortcut .mode:hover {
        color: #fff;
      }

      #modeShortcut .mode.active {
        color: #fff;
        font-weight: 700;
        cursor: default;
      }

      #detailPanel {
        margin-top: 64px;
      }

      .mode-btn:hover {
        background: #fff;
        color: #000;
      }

      .mode-btn.active {
        background: #fff;
        color: #000;
        font-weight: 600;
        cursor: default;
      }

      /* --- 변경 이력 (History) 스타일 --- */
      .history-panel {
        width: calc(100% - 40px);
        margin: 20px auto 40px auto;
        background: #252525;
        border-radius: 12px;
        padding: 30px;
        border: 1px solid #444;
      }
      .history-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #333;
        margin-bottom: 10px;
        border-radius: 8px;
        border-left: 5px solid #888;
        gap: 20px;
      }
      .history-item.add {
        border-left-color: #2ecc71;
      }
      .history-item.move {
        border-left-color: #3498db;
      }
      .history-item.remove {
        border-left-color: #e74c3c;
      }
      .history-item.info {
        border-left-color: #f1c40f;
      }
      .history-item.reeval {
        border-left-color: #9b59b6;
      }

      .history-content-wrapper {
        transition:
          max-height 0.3s ease-out,
          opacity 0.2s;
        max-height: 2000px;
        opacity: 1;
        overflow: hidden;
      }
      .history-content-wrapper.collapsed {
        max-height: 0;
        opacity: 0;
      }

      /* --- 개발자 패널 --- */
      .dev-panel {
        position: fixed;
        top: 0;
        right: -450px; /* 기본적으로 숨김 */
        width: 450px;
        height: 100%;
        background: #222;
        color: white;
        transition: 0.3s ease-in-out;
        z-index: 1000;
        padding: 25px;
        overflow-y: auto;
        border-left: 3px solid #444;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
        font-family: 'Paperlogy5', sans-serif;
      }
      .dev-panel.open {
        right: 0;
      }

      #devPanel h2,
      #devPanel h3 {
        font-family: 'Paperlogy9';
        margin-top: 0;
        color: #fff;
        border-bottom: 2px solid #444;
        padding-bottom: 10px;
      }

      #devPanel label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        font-size: 0.85rem;
        color: #aaa;
        font-family: 'Paperlogy7';
      }

      /* --- 입력창 스타일 --- */
      .dev-input {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        background: #333;
        color: white;
        border: 1px solid #555;
        border-radius: 5px;
        font-family: 'Paperlogy3';
        font-size: 0.9rem;
        transition: border 0.2s;
      }

      .dev-input:focus {
        outline: none;
        border-color: #4f9;
      }

      textarea.dev-input {
        resize: vertical;
        min-height: 60px;
        font-family: monospace; /* JSON 데이터 가독성을 위해 */
      }

      /* --- 버튼 스타일 --- */
      .dev-btn {
        width: 100%;
        padding: 12px;
        background: #444;
        border: none;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 10px;
        font-family: 'Paperlogy7';
        font-size: 1rem;
        transition: 0.2s;
      }
      .dev-btn:hover {
        background: #666;
        transform: translateY(-2px);
      }
      .dev-btn-save {
        background: #2ecc71 !important;
        color: #000 !important;
      }
      .dev-btn-save:hover {
        background: #27ae60 !important;
      }

      /* 개발자 패널 리스트 아이템 */
      #devContent .item {
        background: #2a2a2a;
        margin-bottom: 5px;
        border-radius: 4px;
        cursor: pointer;
        border-left: 4px solid #555;
        transition: 0.2s;
      }

      #devContent .item:hover {
        background: #3a3a3a;
        border-left-color: #4f9;
        padding-left: 15px !important;
      }

      /* --- 스크롤바 커스텀 --- */
      #devPanel::-webkit-scrollbar {
        width: 8px;
      }
      #devPanel::-webkit-scrollbar-track {
        background: #222;
      }
      #devPanel::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 10px;
      }
      #devPanel::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* 태그 내용 감싸는 영역 */
      .tag-content {
        max-height: 500px;
        overflow: hidden;
        transition:
          max-height 0.3s ease-out,
          opacity 0.2s;
        opacity: 1;
      }
      .tag-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: 0;
      }
    </style>
  </head>

  <body>
    <div class="auth-bar">
      <div id="userStatus" class="user-status"></div>
      <button class="auth-btn" onclick="login()">계정 선택</button>
    </div>

    <div class="header-container">
      <button class="hamburger" onclick="toggleMenu()">☰</button>
      <a
        href="../index.html"
        class="header-btn-wrapper"
        style="text-decoration: none"
        ><button class="header-btn">홈</button></a
      >
      <a
        href="../level.html"
        class="header-btn-wrapper"
        style="text-decoration: none"
        ><button class="header-btn" style="font-family: Paperlogy9">
          레벨
        </button></a
      >
      <div class="header-btn-wrapper">
        <a href="../mappack.html" class="header-btn-wrapper">
          <button class="header-btn">맵 팩</button>
        </a>
      </div>
      <div class="header-btn-wrapper">
        <a href="../roulette.html" class="header-btn-wrapper">
          <button class="header-btn">룰렛</button>
        </a>
      </div>
    </div>

    <div class="divider"></div>

    <div id="detailHeader">
      <div id="headerTitle">Platformer</div>
      <div id="detailSubtitle">
        초친 멤버들이 만든 플랫포머 레벨을 모아놓은 곳입니다.
      </div>
      <div style="margin-top: 70px"></div>
      <div id="detailSubtitle"><레벨 리스트 바로가기></div>
      <div id="modeShortcut">
        <button class="mode-btn" onclick="location.href = 'classic.html'">
          Classic
        </button>
        <button class="mode-btn" onclick="location.href = 'challenge.html'">
          Challenge
        </button>
        <button class="mode-btn active">Platformer</button>
      </div>
    </div>

    <div class="main-container">
      <div class="container">
        <input
          id="search"
          placeholder="제목 또는 태그 검색..."
          oninput="updateFilter()"
        />
        <div class="tag-filter-container">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div class="section-title">태그 필터</div>
            <button
              onclick="toggleTagPanel()"
              id="tagToggleBtn"
              style="
                background: none;
                border: 1px solid #555;
                color: #ccc;
                cursor: pointer;
                border-radius: 4px;
                padding: 2px 8px;
              "
            >
              펴기
            </button>
          </div>
          <div id="tagContent" class="tag-content collapsed">
            <div id="tagCategoryContainer"></div>
          </div>
        </div>
        <div id="list" style="overflow-y: auto"></div>
      </div>

      <div class="detail-panel">
        <div class="detail-header">
          <div id="detailTitle" class="detail-title"></div>
          <div id="detailCreator" class="detail-creator"></div>
        </div>

        <div class="video-wrapper">
          <iframe id="detailVideo" allowfullscreen></iframe>
        </div>

        <div class="detail-content">
          <div id="infoSection" class="info-section"></div>
          <div id="graphSection" class="graph-section"></div>
          <div id="detailDescription"></div>
        </div>

        <p class="fp-warning">※ 프레임 퍼펙트는 정확하지 않습니다 ※</p>
      </div>

      <div class="detail-panel clears-panel">
        <div
          style="
            font-family: Paperlogy9;
            font-size: 3.2rem;
            text-align: center;
            color: white;
          "
        >
          클리어 명단
        </div>
        <div id="detailClears"></div>
      </div>
    </div>

    <div id="historySection" class="section" style="margin: 0 20px 40px 20px">
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 10px;
        "
      >
        <div class="section-title" style="margin-bottom: 0">
          변경 이력 (Level History)
        </div>
        <button
          onclick="toggleHistoryPanel()"
          id="historyToggleBtn"
          style="
            background: none;
            border: 1px solid #555;
            color: #ccc;
            cursor: pointer;
            border-radius: 4px;
            padding: 2px 8px;
          "
        >
          접기
        </button>
      </div>
      <div id="historyContentWrapper" class="history-content-wrapper">
        <div id="historyList"></div>
      </div>
    </div>

    <div id="devPanel" class="dev-panel">
      <div class="detail-header" style="margin-top: 20px">
        <div class="detail-title" style="font-size: 2.5rem">개발자 패널</div>
        <div id="devContent" class="dev-content"></div>
      </div>
    </div>

    <script>
      const TAG_GROUPS = {
        '주 게임모드': [
          'Cube',
          'Ship',
          'Ball',
          'UFO',
          'Wave',
          'Robot',
          'Spider',
          'Swing',
          'Any-Mode',
        ],
        속도: ['0.5x', '1x', '2x', '3x', '4x', 'Any-Speed'],
        길이: ['Short', 'Medium', 'Long', 'XL', 'XXL', 'XXXL'],
        성격: ['Memory', 'Sync', 'Gimmick', 'Physical', 'Spam'],
        특이사항: [
          'None-Effect',
          'Low-Effect',
          'Full-Effect',
          'One-Mode',
          'No-Clear',
        ],
      };

      const FILTER_CATEGORIES = {
        모드: TAG_GROUPS['주 게임모드'],
        길이: TAG_GROUPS['길이'],
        특징: TAG_GROUPS['성격'],
        기타: TAG_GROUPS['특이사항'],
      };

      const PLAYER_YOUTUBE = {
        imBBBT: 'https://www.youtube.com/@imBBBT',
        Choco: 'https://www.youtube.com/@초코5768',
        Light: 'https://www.youtube.com/@CC_Light722',
        Timo: 'https://www.youtube.com/@SNIPER_Timo',
      };

      const selectedTags = new Set();
      const DEV_PASSWORD = '6974';

      // GitHub 설정 상수
      const GH_OWNER = 'imBBBT';
      const GH_REPO = 'chochin-forum';
      const GH_PATH = 'level/platformer.json';
      const GH_TOKEN = ''; // 토큰을 코드에 고정하려면 이곳에 입력하세요.

      let githubConfig = {
        owner: GH_OWNER,
        repo: GH_REPO,
        path: GH_PATH,
        token: GH_TOKEN || localStorage.getItem('gh_token') || '',
      };

      let demonData = [];
      let changeHistory = [];
      let filteredData = [];
      let currentUser = localStorage.getItem('currentUser') || null;

      window.onload = async function () {
        try {
          const response = await fetch('platformer.json');
          const data = await response.json();

          demonData = data.levels || data.buttons || data || [];
          changeHistory = data.history || [];
          filteredData = [...demonData];

          if (currentUser) {
            document.getElementById('userStatus').innerText =
              `접속 계정 : ${currentUser}`;
          }

          renderTagFilterButtons();
          generateList(filteredData);
          renderHistory();

          const urlParams = new URLSearchParams(window.location.search);
          const idParam = urlParams.get('id');
          let initialIndex = 0;

          if (idParam) {
            const foundIndex = filteredData.findIndex((d) => d.id == idParam);
            if (foundIndex !== -1) initialIndex = foundIndex;
          }

          if (filteredData.length > 0) {
            const list = document.getElementById('list');
            const targetEl = list.children[initialIndex];
            showDetail(filteredData[initialIndex], targetEl);
            if (idParam && targetEl)
              targetEl.scrollIntoView({ block: 'center' });
          }
        } catch (err) {
          console.error(err);
          document.getElementById('list').innerHTML =
            `<div style="color:white;text-align:center;padding:20px;">데이터를 불러오는 데 실패했습니다.</div>`;
        }
      };

      function login() {
        const name = prompt('닉네임을 입력해주세요.');
        if (!name) return;

        currentUser = name;
        localStorage.setItem('currentUser', name);
        document.getElementById('userStatus').innerText = `접속 계정 : ${name}`;
        alert(`${name}님, 환영합니다!`);

        generateList(filteredData);
      }

      function checkIfCleared(item) {
        if (!currentUser) return false;
        const name = currentUser.toLowerCase();

        const isInClearList =
          item.clears &&
          item.clears.some((c) => c.player.toLowerCase() === name);
        const isVerifier =
          item.verifier && item.verifier.toLowerCase() === name;

        return isInClearList || isVerifier;
      }

      function showDetail(item, element) {
        document
          .querySelectorAll('.item')
          .forEach((el) => el.classList.remove('active'));
        if (element) element.classList.add('active');

        // 요소 확인
        const clearBox = document.getElementById('detailClears');
        if (!clearBox) return;

        document.getElementById('detailTitle').textContent = item.title;
        document.getElementById('detailCreator').textContent =
          item.creator === item.verifier
            ? `by ${item.creator}`
            : `by ${item.creator} / Verified by ${item.verifier}`;

        const videoFrame = document.getElementById('detailVideo');
        if (videoFrame) {
          videoFrame.src = item.video ? item.video : 'about:blank';
        }

        const info = document.getElementById('infoSection');
        if (info) {
          info.innerHTML = '';
          if (item.map) {
            info.innerHTML = `
          <div class="info-row" style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #555;">
            <span><b>ID:</b> ${item.map?.mapId || '-'}</span>
            <span><b>Length:</b> ${item.map?.length || '-'}</span>
            <span><b>Objects:</b> ${
              item.map?.objects?.toLocaleString() || '0'
            }</span>
            <span><b>Date:</b> ${item.map?.uploadDate || '-'}</span>
          </div>
          <div class="song-info" style="background: #333; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
            <div style="font-family: Paperlogy7; color: #fff;">노래 정보</div>
            <div style="font-size: 0.9rem; color: #eee; font-family: Paperlogy5;">
              ${item.song?.artist || 'Unknown'} - ${item.song?.name || 'Unknown'}
              <span style="color: #888;">(ID: ${item.song?.id || '-'})</span>
            </div>
          </div>
        `;
          }
        }

        const graph = document.getElementById('graphSection');
        if (graph) {
          graph.innerHTML = '';
          if (item.gameplay) {
            graph.innerHTML += makeRatioGraph(
              '게임모드 비율',
              item.gameplay.modeRatio,
            );
            graph.innerHTML += makeRatioGraph(
              '속도 비율',
              item.gameplay.speedRatio,
            );
          }
          if (item.framePerfect) {
            graph.innerHTML += makeRatioGraph(
              '프레임 퍼펙트',
              item.framePerfect.fps,
              '',
            );
          }
        }

        const description = document.getElementById('detailDescription');
        if (description) {
          description.innerHTML = '';
          if (item.tags?.length) {
            const tagsHtml = item.tags
              .map(
                (t) =>
                  `<span class="tag" onclick="searchByTag('${t}')">#${t}</span>`,
              )
              .join('');
            description.innerHTML = `<div class="section"><div class="section-title">태그</div><div class="tag-group-container">${tagsHtml}</div></div>`;
          }
        }

        clearBox.innerHTML = '';
        if (item.clears && item.clears.length > 0) {
          item.clears.forEach((c, i) => {
            const row = document.createElement('div');
            row.className = `clear-row rank-${i + 1}`;
            const youtube =
              typeof PLAYER_YOUTUBE !== 'undefined'
                ? PLAYER_YOUTUBE[c.player]
                : null;
            const playerHTML = youtube
              ? `<a href="${youtube}" target="_blank">${c.player}</a>`
              : c.player;
            row.innerHTML = `
            <div class="clear-rank">#${i + 1}</div>
            <div class="clear-player">${playerHTML}</div>
            <div class="clear-percent ${c.percent === 100 ? 'full' : ''}">${
              c.percent
            }%</div>
            <div class="clear-date">${c.date}</div>
          `;
            clearBox.appendChild(row);
          });
        }

        if (typeof renderHistory === 'function') {
          renderHistory(item.title);
        }
      }

      function makeRatioGraph(title, data, suffix = '%') {
        if (!data || Object.keys(data).length === 0) return '';
        return `
        <div class="graph-box">
          <div class="graph-title">${title}</div>
          ${Object.entries(data)
            .map(
              ([k, v]) => `
            <div class="graph-row">
              <div class="graph-label">${k}</div>
              <div class="graph-bar-bg"><div class="graph-bar" data-key="${k}" style="width:${v}%"></div></div>
              <div class="graph-value">${v}${suffix}</div>
            </div>
          `,
            )
            .join('')}
        </div>
      `;
      }

      function generateList(data) {
        const list = document.getElementById('list');
        list.innerHTML = '';

        if (data.length === 0) {
          list.innerHTML =
            '<div style="color:#aaa; text-align:center; margin-top:20px;">검색 결과가 없습니다.</div>';
          return;
        }

        data.forEach((d) => {
          const isDone = checkIfCleared(d);
          const div = document.createElement('div');
          div.className = `item ${isDone ? 'cleared' : ''}`;
          div.innerHTML = `
          <div class="rank">${d.id}</div>
          <div>
            <div class="title">${d.title} ${
              isDone ? '<span class="clear-check">✅</span>' : ''
            }</div>
            <div class="creator">by ${d.creator}</div>
          </div>
        `;
          div.onclick = () => showDetail(d, div);
          list.appendChild(div);
        });
      }

      function renderTagFilterButtons() {
        const container = document.getElementById('tagCategoryContainer');
        container.innerHTML = Object.entries(FILTER_CATEGORIES)
          .map(
            ([catName, tags]) => `
        <div class="tag-cat-row">
          <div class="tag-cat-name">${catName}</div>
          <div class="tag-cat-list">
            ${tags
              .map(
                (t) =>
                  `<button class="filter-tag-btn" onclick="searchByTag('${t}')">#${t}</button>`,
              )
              .join('')}
          </div>
        </div>
      `,
          )
          .join('');
      }

      function searchByTag(tagName) {
        const searchInput = document.getElementById('search');
        if (searchInput.value === tagName) searchInput.value = '';
        else searchInput.value = tagName;
        updateFilter();
      }

      function updateFilter() {
        const term = document
          .getElementById('search')
          .value.toLowerCase()
          .trim();
        document.querySelectorAll('.filter-tag-btn').forEach((btn) => {
          if (btn.innerText.toLowerCase() === `#${term}`)
            btn.classList.add('active');
          else btn.classList.remove('active');
        });

        const filteredData = demonData.filter((item) => {
          const titleMatch = item.title.toLowerCase().includes(term);
          const tagMatch =
            item.tags &&
            item.tags.some(
              (t) => t.toLowerCase() === term || t.toLowerCase().includes(term),
            );
          return titleMatch || tagMatch;
        });

        generateList(filteredData);
        if (filteredData.length > 0) showDetail(filteredData[0]);
      }

      // --- 개발자 패널 로직 ---
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'e') {
          const panel = document.getElementById('devPanel');
          if (panel.classList.contains('open')) panel.classList.remove('open');
          else if (prompt('개발자 비밀번호') === DEV_PASSWORD) {
            panel.classList.add('open');
            renderDevHome();
          }
        }
      });

      function renderDevHome() {
        document.getElementById('devContent').innerHTML = `
        <button class="dev-btn" onclick="renderLevelForm()">새 레벨 등록</button>
        <button class="dev-btn" onclick="renderEditList()">레벨 수정</button>
        <button class="dev-btn" onclick="renderGitHubConfig()" style="background:#8e44ad;">GitHub 설정</button>
        <button class="dev-btn" onclick="saveToGitHub()" style="background:#2980b9;">GitHub에 저장</button>
        <button class="dev-btn" onclick="exportJson()" style="background:#5cb85c;">JSON 내보내기</button>
      `;
      }

      function renderGitHubConfig() {
        const isTokenFixed = !!GH_TOKEN;
        document.getElementById('devContent').innerHTML = `
        <h3>GitHub 연동 설정</h3>
        <div style="display:flex; flex-direction:column; gap:10px;">
          <label>Repository Owner (고정)</label>
          <input class="dev-input" value="${
            githubConfig.owner
          }" readonly style="background:#222; color:#888;">

          <label>Repository Name (고정)</label>
          <input class="dev-input" value="${
            githubConfig.repo
          }" readonly style="background:#222; color:#888;">

          <label>File Path (고정)</label>
          <input class="dev-input" value="${
            githubConfig.path
          }" readonly style="background:#222; color:#888;">

          <label>Personal Access Token ${isTokenFixed ? '(고정됨)' : ''}</label>
          <input id="gh-token" class="dev-input" type="password" value="${
            githubConfig.token
          }" ${
            isTokenFixed
              ? 'readonly style="background:#222; color:#888;"'
              : 'placeholder="ghp_..."'
          }>

          ${
            !isTokenFixed
              ? '<button class="dev-btn dev-btn-save" onclick="saveGitHubConfig()">토큰 저장</button>'
              : ''
          }
          <button class="dev-btn" onclick="renderDevHome()">뒤로가기</button>
        </div>
      `;
      }

      function saveGitHubConfig() {
        if (!GH_TOKEN) {
          githubConfig.token = document.getElementById('gh-token').value.trim();
          localStorage.setItem('gh_token', githubConfig.token);
          alert('토큰이 저장되었습니다.');
        }
        renderDevHome();
      }

      async function saveToGitHub() {
        if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo) {
          if (confirm('GitHub 설정이 필요합니다. 설정 화면으로 이동할까요?'))
            renderGitHubConfig();
          return;
        }

        // platformer.json 구조에 맞게 저장 (levels 키 사용 권장)
        const content = JSON.stringify(
          { levels: demonData, history: changeHistory },
          null,
          2,
        );
        const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}`;

        try {
          let sha = null;
          const getRes = await fetch(url, {
            headers: {
              Authorization: `Bearer ${githubConfig.token}`,
              Accept: 'application/vnd.github.v3+json',
            },
          });
          if (getRes.ok) {
            const json = await getRes.json();
            sha = json.sha;
          }

          const putRes = await fetch(url, {
            method: 'PUT',
            headers: {
              Authorization: `Bearer ${githubConfig.token}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              message: `Update ${githubConfig.path} via Web`,
              content: btoa(unescape(encodeURIComponent(content))),
              sha: sha,
            }),
          });

          if (putRes.ok) alert('GitHub에 성공적으로 저장되었습니다!');
          else {
            const err = await putRes.json();
            alert(`저장 실패: ${err.message}`);
          }
        } catch (e) {
          alert(`오류 발생: ${e.message}`);
        }
      }

      function renderEditList() {
        let html =
          '<h3>수정할 레벨 선택</h3><div style="max-height:300px; overflow-y:auto; background:#333; border-radius:5px;">';
        demonData.forEach((lv, idx) => {
          html += `<div class="item" style="padding:10px; border-bottom:1px solid #444;" onclick="renderLevelForm(${idx})">
                  ${lv.id}. ${lv.title}
                  </div>`;
        });
        html +=
          '</div><button class="dev-btn" onclick="renderDevHome()">뒤로가기</button>';
        document.getElementById('devContent').innerHTML = html;
      }

      function renderLevelForm(idx = null) {
        const isEdit = idx !== null;
        const lv = isEdit
          ? demonData[idx]
          : {
              title: '',
              creator: '',
              verifier: '',
              video: '',
              map: { mapId: '', length: '', objects: 0, uploadDate: '' },
              song: { name: '', artist: '', id: '' },
              gameplay: { modeRatio: {}, speedRatio: {} },
              framePerfect: { total: 0, fps: {} },
              tags: [],
            };

        // 입력 필드 생성 헬퍼
        const mkInput = (id, ph, val, type = 'text') =>
          `<input id="${id}" class="dev-input" type="${type}" placeholder="${ph}" value="${
            val || ''
          }">`;

        document.getElementById('devContent').innerHTML = `
        <h3>${isEdit ? '레벨 수정' : '새 레벨 등록'}</h3>
        <div style="max-height:450px; overflow-y:auto; padding-right:5px; display:flex; flex-direction:column; gap:10px;">
          <label>순위 설정 (현재 총 ${demonData.length}개)</label>
          ${mkInput(
            'f-placement',
            `순위 (1~${demonData.length + (isEdit ? 0 : 1)})`,
            isEdit ? idx + 1 : demonData.length + 1,
            'number',
          )}

          <label>기본 정보</label>
          ${mkInput('f-title', '제목', lv.title)}
          ${mkInput('f-creator', '제작자', lv.creator)}
          ${mkInput('f-verifier', '베리파이어', lv.verifier)}
          ${mkInput('f-video', '영상 URL', lv.video)}

          <label>맵 정보</label>
          ${mkInput('f-mid', '맵 ID', lv.map?.mapId)}
          ${mkInput('f-mlen', '길이', lv.map?.length)}
          ${mkInput('f-mobj', '오브젝트', lv.map?.objects)}
          ${mkInput('f-mdate', '날짜', lv.map?.uploadDate)}

          <label>노래 정보</label>
          ${mkInput('f-sname', '노래 제목', lv.song?.name)}
          ${mkInput('f-sauth', '작곡가', lv.song?.artist)}
          ${mkInput('f-sid', '노래 ID', lv.song?.id)}

          <label>태그 (쉼표 구분)</label>
          ${mkInput('f-tags', '태그1, 태그2', lv.tags?.join(', '))}
        </div>
        <button class="dev-btn dev-btn-save" onclick="saveLevelForm(${idx})">${
          isEdit ? '수정 완료' : '등록 완료'
        }</button>
        ${
          isEdit
            ? `<button class="dev-btn" onclick="deleteLevel(${idx})" style="background:#e74c3c;">삭제</button>`
            : ''
        }
        <button class="dev-btn" onclick="renderDevHome()">취소</button>

        <label>기록 관리 (Clears)</label>
          <div id="f-clears-container" style="display:flex; flex-direction:column; gap:5px;">
            ${(lv.clears || [])
              .map(
                (c, i) => `
              <div class="clear-edit-row" style="display:flex; gap:3px;">
                <input class="dev-input cl-p" placeholder="유저" value="${
                  c.player
                }" style="flex:2">
                <input class="dev-input cl-v" placeholder="%" value="${
                  c.percent
                }" style="flex:1">
                <input class="dev-input cl-d" placeholder="날짜" value="${
                  c.date || ''
                }" style="flex:1.5">
                <button onclick="this.parentElement.remove()" style="background:#e74c3c; border:none; color:white; border-radius:4px; cursor:pointer; width:30px;">X</button>
              </div>
            `,
              )
              .join('')}
          </div>
          <button class="dev-btn" onclick="addClearInputRow()" style="background:#3498db; margin-top:5px;">+ 기록 추가</button>
      `;
      }

      function saveLevelForm(idx) {
        const isEdit = idx !== null;

        try {
          // 1. 유저 기록(Clears) 데이터 수집
          const playerInputs = document.querySelectorAll('.cl-p');
          const percentInputs = document.querySelectorAll('.cl-v');
          const dateInputs = document.querySelectorAll('.cl-d');
          const newClears = [];
          const placementInput = document.getElementById('f-placement');
          let targetRank = placementInput
            ? parseInt(placementInput.value) - 1
            : isEdit
              ? idx
              : demonData.length;

          playerInputs.forEach((input, i) => {
            const pName = input.value.trim();
            if (pName) {
              newClears.push({
                player: pName,
                percent: parseInt(percentInputs[i].value) || 100,
                date: dateInputs[i]?.value.trim() || '',
              });
            }
          });

          // 2. 입력값 수집
          const getValue = (id) => document.getElementById(id)?.value || '';

          const newData = {
            id: isEdit ? demonData[idx].id : demonData.length + 1,
            title: getValue('f-title'),
            creator: getValue('f-creator'),
            verifier: getValue('f-verifier'),
            video: getValue('f-video'),
            map: {
              mapId: getValue('f-mid'),
              length: getValue('f-mlen'),
              objects: parseInt(getValue('f-mobj')) || 0,
              uploadDate: getValue('f-mdate'),
            },
            song: {
              name: getValue('f-sname'),
              artist: getValue('f-sauth'),
              id: getValue('f-sid'),
            },
            gameplay: isEdit
              ? demonData[idx].gameplay
              : { modeRatio: {}, speedRatio: {} },
            framePerfect: isEdit
              ? demonData[idx].framePerfect
              : { total: 0, fps: {} },
            tags: getValue('f-tags')
              .split(',')
              .map((t) => t.trim())
              .filter((t) => t),
            clears: newClears,
          };

          if (isEdit) {
            const oldRank = idx;
            if (oldRank !== targetRank) {
              const direction = targetRank < oldRank ? '상승' : '하락';
              addHistory(
                'reeval',
                newData.title,
                `'${newData.title}' 레벨의 재평가로 인해 순위가 ${oldRank + 1}위에서 ${
                  targetRank + 1
                }위로 ${direction}하였습니다.`,
              );

              const start = Math.min(oldRank, targetRank);
              const end = Math.max(oldRank, targetRank);
              const shift = targetRank < oldRank ? 1 : -1;

              for (let i = start; i <= end; i++) {
                if (i === oldRank) continue;
                const affectedLv = demonData[i];
                const shiftDir = shift > 0 ? '하락' : '상승';
                addHistory(
                  'move',
                  affectedLv.title,
                  `'${newData.title}' 레벨의 순위 변동으로 인해 순위가 ${i + 1}위에서 ${
                    i + 1 + shift
                  }위로 ${shiftDir}하였습니다.`,
                );
              }

              demonData.splice(oldRank, 1);
              demonData.splice(targetRank, 0, newData);
            } else {
              demonData[idx] = newData;
            }
          } else {
            for (let i = targetRank; i < demonData.length; i++) {
              addHistory(
                'move',
                demonData[i].title,
                `'${newData.title}' 레벨 추가로 인해 순위가 ${i + 1}위에서 ${
                  i + 2
                }위로 하락하였습니다.`,
              );
            }
            demonData.splice(targetRank, 0, newData);
            addHistory(
              'add',
              newData.title,
              `${targetRank + 1}위에 새로운 레벨이 등록되었습니다.`,
            );
          }

          demonData.forEach((d, i) => (d.id = i + 1));

          generateList(demonData);
          alert(
            '저장되었습니다 (로컬). GitHub에 저장하려면 "GitHub에 저장" 버튼을 누르세요.',
          );
          renderDevHome();
        } catch (err) {
          console.error('저장 중 에러 발생:', err);
          alert('저장 실패');
        }
      }

      function deleteLevel(idx) {
        if (!confirm('정말 삭제하시겠습니까?')) return;

        const deletedLv = demonData[idx];
        const oldRank = idx + 1;
        addHistory(
          'remove',
          deletedLv.title,
          `${oldRank}위에 있던 레벨이 삭제되었습니다.`,
        );

        for (let i = idx + 1; i < demonData.length; i++) {
          const affectedLv = demonData[i];
          addHistory(
            'move',
            affectedLv.title,
            `'${deletedLv.title}' 레벨 삭제로 인해 순위가 ${i + 1}위에서 ${i}위로 상승하였습니다.`,
          );
        }

        demonData.splice(idx, 1);

        // ID 재정렬
        demonData.forEach((d, i) => (d.id = i + 1));
        generateList(demonData);
        renderDevHome();
      }

      function exportJson() {
        const data = { levels: demonData, history: changeHistory };
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: 'application/json',
        });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'platformer.json';
        a.click();
      }

      function addHistory(type, title, detail) {
        const now = new Date();
        const timeStr = `${now.getFullYear()}-${String(
          now.getMonth() + 1,
        ).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')} ${String(
          now.getHours(),
        ).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;

        if (typeof changeHistory !== 'undefined') {
          changeHistory.unshift({
            time: timeStr,
            type: type,
            title: title,
            detail: detail,
          });
        }
      }

      // 기록 입력 행을 동적으로 추가하는 함수
      function addClearInputRow() {
        const container = document.getElementById('f-clears-container');
        const div = document.createElement('div');
        div.className = 'clear-edit-row';
        div.style = 'display:flex; gap:3px;';
        div.innerHTML = `
        <input class="dev-input cl-p" placeholder="유저" style="flex:2">
        <input class="dev-input cl-v" placeholder="%" style="flex:1">
        <input class="dev-input cl-d" placeholder="날짜" style="flex:1.5">
        <button onclick="this.parentElement.remove()" style="background:#e74c3c; border:none; color:white; border-radius:4px; cursor:pointer; width:30px;">X</button>
      `;
        container.appendChild(div);
      }

      function renderHistory(targetTitle = null) {
        const list = document.getElementById('historyList');
        if (!list) return;
        list.innerHTML = '';

        if (targetTitle) {
          let bestRank = 999999;
          const currentLv = demonData.find((l) => l.title === targetTitle);
          if (currentLv) bestRank = currentLv.id;

          const specificHistory = changeHistory.filter(
            (h) => h.title === targetTitle,
          );
          specificHistory.forEach((h) => {
            const matches = h.detail.match(/(\d+)위/g);
            if (matches) {
              matches.forEach((m) => {
                const r = parseInt(m.replace('위', ''));
                if (!isNaN(r) && r < bestRank) bestRank = r;
              });
            }
          });

          if (bestRank !== 999999) {
            const bestRankDiv = document.createElement('div');
            bestRankDiv.style =
              'background: #333; color: #ffd700; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-family: Paperlogy7; border: 1px solid #ffd700;';
            bestRankDiv.innerHTML = `🏆 최고 순위 : ${bestRank}위`;
            list.appendChild(bestRankDiv);
          }
        }

        const displayData = targetTitle
          ? changeHistory.filter((h) => h.title === targetTitle)
          : changeHistory;
        displayData.forEach((h) => {
          let typeClass =
            h.type === 'add'
              ? 'add'
              : h.type === 'remove'
                ? 'remove'
                : h.type === 'reeval'
                  ? 'reeval'
                  : 'move';
          const item = document.createElement('div');
          item.className = `history-item ${typeClass}`;
          item.style =
            'display: flex; gap: 15px; padding: 10px; border-bottom: 1px solid #444; color: #eee;';
          item.innerHTML = `
          <div style="color: #aaa; min-width: 100px;">${h.time.split(' ')[0]}</div>
          <div style="flex: 1;"><b style="color: #fff;">${h.title}</b> ${
            h.detail
          }</div>
        `;
          list.appendChild(item);
        });
      }

      function toggleTagPanel() {
        const content = document.getElementById('tagContent');
        const btn = document.getElementById('tagToggleBtn');

        content.classList.toggle('collapsed');

        // 버튼 텍스트 변경
        if (content.classList.contains('collapsed')) {
          btn.textContent = '펴기';
        } else {
          btn.textContent = '접기';
        }
      }

      function toggleHistoryPanel() {
        const wrapper = document.getElementById('historyContentWrapper');
        const btn = document.getElementById('historyToggleBtn');
        wrapper.classList.toggle('collapsed');
        if (wrapper.classList.contains('collapsed')) {
          btn.textContent = '펴기';
        } else {
          btn.textContent = '접기';
        }
      }

      function toggleMenu() {
        const header = document.querySelector('.header-container');
        header.classList.toggle('open');
      }
    </script>
  </body>
</html>
