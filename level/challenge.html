<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì´ˆì¹œ í¬ëŸ¼ (ë ˆë²¨ - ì±Œë¦°ì§€)</title>

    <style>
      /* --- ê¸°ë³¸ ì„¤ì • --- */
      html,
      body {
        height: 100vh;
        margin: 0;
        background: #323232;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      * {
        box-sizing: border-box;
      }

      /* í°íŠ¸ ì„¤ì • */
      @font-face {
        font-family: Paperlogy1;
        src: url('../font - paperlogy/Paperlogy-1.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy2;
        src: url('../font - paperlogy/Paperlogy-2.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy3;
        src: url('../font - paperlogy/Paperlogy-3.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy4;
        src: url('../font - paperlogy/Paperlogy-4.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy5;
        src: url('../font - paperlogy/Paperlogy-5.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy6;
        src: url('../font - paperlogy/Paperlogy-6.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy7;
        src: url('../font - paperlogy/Paperlogy-7.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy8;
        src: url('../font - paperlogy/Paperlogy-8.ttf');
        font-display: swap;
      }
      @font-face {
        font-family: Paperlogy9;
        src: url('../font - paperlogy/Paperlogy-9.ttf');
        font-display: swap;
      }

      /* [ìˆ˜ì •] ëª¨ë“  ë§í¬ì˜ íŒŒë€ìƒ‰ ë°‘ì¤„ ì œê±° */
      a {
        color: inherit;
        text-decoration: none;
      }

      h1 {
        font-family: Paperlogy7;
        color: white;
        font-size: 170px;
        text-align: center;
      }
      h4 {
        font-family: Paperlogy3;
        color: #a0a0a0;
        text-align: center;
      }
      p,
      span {
        font-family: Paperlogy2;
        color: #c8c8c8;
      }

      /* --- ê³„ì • ë°” ìŠ¤íƒ€ì¼ --- */
      .auth-bar {
        background: #202020;
        padding: 10px 20px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 15px;
        border-bottom: 2px solid #444;
      }
      .user-status {
        color: #4f9;
        font-family: Paperlogy5;
        font-size: 0.95rem;
      }
      .auth-btn {
        background: transparent;
        border: 1.5px solid #fff;
        color: #fff;
        padding: 5px 15px;
        border-radius: 5px;
        font-family: Paperlogy7;
        cursor: pointer;
        transition: 0.2s;
      }
      .auth-btn:hover {
        background: #fff;
        color: #000;
      }

      /* --- í—¤ë” ì˜ì—­ --- */
      .header-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 5vw;
        padding: 2vh 0;
        flex-wrap: wrap;
      }
      .header-btn-wrapper {
        width: min(400px, 90vw);
        display: flex;
        justify-content: center;
      }
      .header-btn {
        background-color: #323232;
        color: white;
        font-size: clamp(1.5rem, 4vw, 3rem);
        cursor: pointer;
        padding: 1.5vh 0;
        border: none;
        border-radius: 10px;
        width: 100%;
        transition:
          background-color 0.25s ease,
          color 0.25s ease;
        font-family: Paperlogy5;
      }
      .header-btn:hover {
        background-color: #fff;
        color: #323232;
      }
      .divider {
        border: 2px solid white;
        width: 100%;
        height: 0;
        margin: 6px 0;
      }
      .hamburger {
        display: none;
        font-size: 2.5rem;
        color: white;
        background: none;
        border: none;
        cursor: pointer;
        padding: 10px;
      }
      .header-container.open .header-btn-wrapper {
        display: flex;
      }

      /* --- ë©”ì¸ ì»¨í…Œì´ë„ˆ ë ˆì´ì•„ì›ƒ (ìˆ˜ì •ë¨) --- */
      .main-container {
        display: flex;
        gap: 20px; /* ê°­ì„ ê³ ì • í”½ì…€ë¡œ ë³€ê²½í•˜ì—¬ ì•ˆì •ì„± í™•ë³´ (ì›í•˜ë©´ %ë¡œ ë³€ê²½ ê°€ëŠ¥) */
        padding: 20px;
        align-items: stretch;
        flex: 1;
        min-height: 0;
      }

      /* íŒ¨ë„ ê³µí†µ ìŠ¤íƒ€ì¼ */
      .container,
      .detail-panel {
        background: #404040;
        border-radius: 10px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      /* ì™¼ìª½ íŒ¨ë„ (ë¦¬ìŠ¤íŠ¸) */
      .container {
        flex: 1; /* ë¹„ìœ¨ 1 */
        min-width: 0; /* ë‚´ìš© ë„˜ì¹¨ ë°©ì§€ */
      }

      /* ê°€ìš´ë° íŒ¨ë„ (ìƒì„¸) */
      .detail-panel {
        flex: 2; /* ë¹„ìœ¨ 2 (ì™¼ìª½ë³´ë‹¤ 2ë°° ë„“ìŒ) */
        background: #505050;
        overflow-y: auto;
        min-width: 0;
      }

      /* ì˜¤ë¥¸ìª½ íŒ¨ë„ (ê¸°ë¡) - detail-panel ìŠ¤íƒ€ì¼ì„ ë®ì–´ì”€ */
      .detail-panel.clears-panel {
        flex: 1; /* ë¹„ìœ¨ 1 */
        background: #404040; /* ë°°ê²½ìƒ‰ ë‹¤ì‹œ ì›ë˜ëŒ€ë¡œ */
      }

      /* í•˜ë‹¨ íˆìŠ¤í† ë¦¬ íŒ¨ë„ */
      .history-panel {
        width: calc(100% - 40px); /* ì¢Œìš° íŒ¨ë”© ê³ ë ¤ */
        margin: 0 auto 40px auto;
        background: #3a3a3a;
        border-radius: 10px;
        padding: 20px;
        min-height: 450px;
      }

      /* ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ */
      @media (max-width: 1400px) {
        body {
          height: auto;
          overflow-y: auto;
        }
        .main-container {
          flex-direction: column;
          flex: none;
        }
        .container,
        .detail-panel,
        .detail-panel.clears-panel {
          width: 100%;
          margin-bottom: 20px;
          height: auto;
          flex: none; /* ë°˜ì‘í˜•ì—ì„œëŠ” ë¹„ìœ¨ í•´ì œ */
          overflow-y: visible;
          min-height: 400px;
        }
        #list {
          overflow-y: auto;
          max-height: 60vh;
        }
        .header-container {
          flex-direction: column;
          gap: 10px;
        }
        .header-btn-wrapper {
          display: none;
        }
        .hamburger {
          display: block;
        }
      }

      /* --- ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ --- */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #555;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #777;
      }

      /* --- ê²€ìƒ‰ ë° ë¦¬ìŠ¤íŠ¸ --- */
      input#search {
        font-size: 18px;
        border-radius: 8px;
        border: none;
        padding: 12px;
        margin-bottom: 10px;
        width: 100%;
        font-family: Paperlogy5;
        background: #333;
        color: white;
      }
      #list {
        flex: 1;
        overflow-y: auto;
      }

      #tagCategoryContainer {
        margin-bottom: 15px;
        background: #383838;
        padding: 10px;
        border-radius: 8px;
      }
      .tag-cat-row {
        display: flex;
        margin-bottom: 6px;
        align-items: flex-start;
      }
      .tag-cat-name {
        color: #aaa;
        font-family: Paperlogy6;
        font-size: 0.85rem;
        width: 50px;
        margin-top: 4px;
        flex-shrink: 0;
      }
      .tag-cat-list {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        flex: 1;
      }
      .filter-tag-btn {
        background: #555;
        color: #ddd;
        border: none;
        padding: 3px 8px;
        border-radius: 12px;
        font-family: Paperlogy4;
        font-size: 0.8rem;
        cursor: pointer;
        transition: 0.2s;
      }
      .filter-tag-btn:hover,
      .filter-tag-btn.active {
        background: #fff;
        color: #000;
      }

      .item {
        display: flex;
        align-items: flex-start;
        padding: 0.9rem 0.5rem;
        gap: 0.8rem;
        border-bottom: 1px solid #777;
        cursor: pointer;
        transition:
          background-color 0.15s ease,
          color 0.15s ease;
        min-height: fit-content;
      }
      .item:hover,
      .item.active {
        background-color: #ffffff;
      }
      .item:hover .title,
      .item:hover .creator,
      .item:hover .rank,
      .item.active .title,
      .item.active .creator,
      .item.active .rank {
        color: #000000;
      }

      .item.cleared {
        background-color: #2e4a2e !important;
        border-left: 6px solid #4f9;
      }
      .item.cleared:hover {
        background-color: #3e5a3e !important;
      }
      .item.cleared.active {
        background-color: #fff !important;
      }

      .clear-check {
        color: #4f9;
        margin-left: 8px;
        font-size: 1.2rem;
      }

      .rank {
        font-family: Paperlogy9;
        font-size: clamp(2rem, 3.2vw, 3.2rem);
        min-width: clamp(2rem, 3.2vw, 3.2rem);
        text-align: center;
        color: #ffffff;
        flex-shrink: 0;
      }
      .title {
        font-family: Paperlogy7;
        font-size: clamp(1.4rem, 2.4vw, 2.4rem);
        line-height: 1.3;
        color: #ffffff;
        word-break: keep-all;
        overflow-wrap: break-word;
      }
      .creator {
        font-family: Paperlogy4;
        font-size: clamp(0.8rem, 1vw, 1rem);
        color: #d0d0d0;
      }

      /* --- ìƒì„¸ ì •ë³´ --- */
      .detail-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        margin-bottom: 10px;
      }
      #detailCreator {
        font-family: Paperlogy4;
        font-size: clamp(1rem, 1.6vw, 1.6rem);
        color: #c8c8c8;
        margin-top: 4px;
      }
      .detail-title {
        font-family: Paperlogy9;
        font-size: clamp(2.4rem, 4.8vw, 4.8rem);
        color: #ffffff;
        line-height: 1.1;
        text-align: center;
        white-space: normal;
        word-break: keep-all;
        margin-bottom: 6px;
      }
      .video-wrapper {
        position: relative;
        width: 100%;
        padding-top: 56.25%;
        background: #000;
        border-radius: 10px;
        overflow: hidden;
      }
      .video-wrapper iframe {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        border: none;
      }
      .section {
        background: #444;
        border-radius: 8px;
        padding: 12px;
        margin-top: 12px;
      }
      .section-title {
        font-family: Paperlogy6;
        font-size: 22px;
        color: #fff;
        margin-bottom: 8px;
      }
      .detail-content {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .info-section,
      .graph-section,
      .tag-section {
        background: #444;
        padding: 14px;
        border-radius: 10px;
      }
      .info-row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        font-family: Paperlogy3;
        font-size: 1rem;
        color: #c8c8c8;
      }
      .info-row span {
        min-width: 45%;
      }
      .fp-warning {
        text-align: center;
        font-family: Paperlogy2;
        font-size: 0.9rem;
        color: #aaa;
        margin-top: 10px;
      }

      /* --- ê·¸ë˜í”„ --- */
      .graph-box {
        margin-bottom: 14px;
      }
      .graph-title {
        font-family: Paperlogy6;
        font-size: 1.2rem;
        color: #fff;
        margin-bottom: 6px;
      }
      .graph-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 4px 0;
      }
      .graph-label {
        width: 90px;
        font-family: Paperlogy3;
        font-size: 0.9rem;
        color: #c8c8c8;
        flex-shrink: 0;
      }
      .graph-bar-bg {
        flex: 1;
        background: #333;
        border-radius: 6px;
        overflow: hidden;
        height: 16px;
      }
      .graph-bar {
        height: 100%;
        border-radius: 6px;
      }
      .graph-value {
        width: 50px;
        text-align: right;
        font-family: Paperlogy4;
        font-size: 0.9rem;
        color: #c8c8c8;
      }
      .graph-total {
        margin-left: 8px;
        font-size: 0.85rem;
        color: #ccc;
        font-family: Paperlogy3;
      }

      /* ê·¸ë˜í”„ ìƒ‰ìƒ ë°ì´í„° ì†ì„± */
      .graph-bar[data-key='Cube'] {
        background: #00ff00;
      }
      .graph-bar[data-key='Ship'] {
        background: #ff00ff;
      }
      .graph-bar[data-key='Ball'] {
        background: #ff0000;
      }
      .graph-bar[data-key='UFO'] {
        background: #ff9900;
      }
      .graph-bar[data-key='Wave'] {
        background: #66ccff;
      }
      .graph-bar[data-key='Robot'] {
        background: #ffffff;
      }
      .graph-bar[data-key='Spider'] {
        background: #9900ff;
      }
      .graph-bar[data-key='Swing'] {
        background: #ffff00;
      }
      .graph-bar[data-key='0.5x'] {
        background: #ffff00;
      }
      .graph-bar[data-key='1x'] {
        background: #66ccff;
      }
      .graph-bar[data-key='2x'] {
        background: #00ff00;
      }
      .graph-bar[data-key='3x'] {
        background: #ff66cc;
      }
      .graph-bar[data-key='4x'] {
        background: #ff0000;
      }
      .graph-bar[data-key='30'] {
        background: #66ccff;
      }
      .graph-bar[data-key='60'] {
        background: #00ff00;
      }
      .graph-bar[data-key='120'] {
        background: #ff00ff;
      }

      /* --- íƒœê·¸ --- */
      .tag-group-container {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-top: 4px;
      }
      .tag {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #5f5f5f;
        color: #ffffff;
        font-family: Paperlogy4;
        font-size: 1rem;
        padding: 6px 14px;
        border-radius: 12px;
        margin: 4px 6px 4px 0;
        cursor: pointer;
        transition: 0.2s;
      }
      .tag:hover {
        background: #888;
        color: #fff;
      }

      /* --- ê¸°ë¡ ëª…ë‹¨ (Clears) --- */
      .clears-panel {
        color: #e0e0e0;
      }
      .clear-row {
        display: flex;
        align-items: center;
        gap: 0.6vw;
        padding: 6px 4px;
        font-family: Paperlogy3;
        font-size: clamp(0.9rem, 1.1vw, 1.1vw);
        color: #e0e0e0;
      }
      .clear-rank {
        font-family: Paperlogy6;
        color: #ffffff;
        min-width: clamp(2rem, 3.5vw, 3.5vw);
        flex-shrink: 0;
      }
      .clear-player {
        flex: 1;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #ffffff;
        font-family: Paperlogy5;
      }
      .clear-percent {
        color: #c8c8c8;
        min-width: clamp(3rem, 4vw, 4vw);
        text-align: right;
        flex-shrink: 0;
      }
      .clear-percent.full {
        color: #ffcc00;
        font-family: Paperlogy6;
      }
      .clear-date {
        font-family: Paperlogy2;
        font-size: 0.8rem;
        color: #b0b0b0;
        flex-shrink: 0;
      }

      /* --- ìƒë‹¨ íƒ€ì´í‹€ --- */
      #detailHeader {
        text-align: center;
        margin-bottom: 64px;
      }
      #headerTitle {
        font-family: Paperlogy7;
        font-size: clamp(80px, 10vw, 170px);
        color: #fff;
        text-align: center;
        margin: 20px 0;
      }
      #detailSubtitle {
        margin-top: 4px;
        color: #aaa;
        font-family: Paperlogy3;
        font-size: clamp(22px, 2.8vw, 32px);
      }
      #modeShortcut {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
        margin-bottom: 18px;
      }
      .mode-btn {
        background: transparent;
        border: 1.5px solid #fff;
        color: #fff;
        padding: 6px 16px;
        border-radius: 999px;
        font-family: Paperlogy7;
        font-size: clamp(1.2rem, 3vw, 2rem);
        font-weight: 500;
        cursor: pointer;
        transition:
          background 0.2s,
          color 0.2s;
      }
      .mode-btn:hover {
        background: #fff;
        color: #000;
      }
      .mode-btn.active {
        background: #fff;
        color: #000;
        font-weight: 600;
        cursor: default;
      }

      /* --- ê°œë°œì íŒ¨ë„ (Dev Panel) --- */
      .dev-panel {
        position: fixed;
        top: 0;
        right: -450px; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
        width: 450px;
        height: 100%;
        background: #222;
        color: white;
        transition: 0.3s ease-in-out;
        z-index: 9999;
        padding: 25px;
        overflow-y: auto;
        border-left: 3px solid #444;
        box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
        font-family: 'Paperlogy5', sans-serif;
      }
      .dev-panel.open {
        right: 0; /* íŒ¨ë„ ì—´ê¸° */
      }

      #devPanel h2,
      #devPanel h3 {
        font-family: 'Paperlogy9';
        margin-top: 0;
        color: #fff;
        border-bottom: 2px solid #444;
        padding-bottom: 10px;
      }

      #devPanel label {
        display: block;
        margin-top: 15px;
        margin-bottom: 5px;
        font-size: 0.85rem;
        color: #aaa;
        font-family: 'Paperlogy7';
      }

      /* --- ì…ë ¥ì°½ ìŠ¤íƒ€ì¼ --- */
      .dev-input {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        background: #333;
        color: white;
        border: 1px solid #555;
        border-radius: 5px;
        font-family: 'Paperlogy3';
        font-size: 0.9rem;
        transition: border 0.2s;
      }

      .dev-input:focus {
        outline: none;
        border-color: #4f9;
      }

      textarea.dev-input {
        resize: vertical;
        min-height: 60px;
        font-family: monospace; /* JSON ë°ì´í„° ê°€ë…ì„±ì„ ìœ„í•´ */
      }

      /* --- ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
      .dev-btn {
        width: 100%;
        padding: 12px;
        background: #444;
        border: none;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        margin-top: 10px;
        font-family: 'Paperlogy7';
        font-size: 1rem;
        transition: 0.2s;
      }
      .dev-btn:hover {
        background: #666;
        transform: translateY(-2px);
      }
      .dev-btn-save {
        background: #2ecc71 !important;
        color: #000 !important;
      }
      .dev-btn-save:hover {
        background: #27ae60 !important;
      }

      /* --- ë ˆë²¨ ìˆ˜ì • ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ --- */
      #devContent .item {
        background: #2a2a2a;
        margin-bottom: 5px;
        border-radius: 4px;
        cursor: pointer;
        border-left: 4px solid #555;
        transition: 0.2s;
      }

      #devContent .item:hover {
        background: #3a3a3a;
        border-left-color: #4f9;
        padding-left: 15px !important;
      }

      /* --- ìŠ¤í¬ë¡¤ë°” ì»¤ìŠ¤í…€ --- */
      #devPanel::-webkit-scrollbar {
        width: 8px;
      }
      #devPanel::-webkit-scrollbar-track {
        background: #222;
      }
      #devPanel::-webkit-scrollbar-thumb {
        background: #444;
        border-radius: 10px;
      }
      #devPanel::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* ë³€ê²½ ì´ë ¥ íŒ¨ë„ ì „ì²´ ë””ìì¸ */
      .history-panel {
        width: calc(100% - 40px);
        margin: 20px auto 40px auto;
        background: #252525;
        border-radius: 12px;
        padding: 30px;
        border: 1px solid #444;
      }

      .history-item {
        display: flex;
        align-items: center;
        padding: 15px;
        background: #333;
        margin-bottom: 10px;
        border-radius: 8px;
        border-left: 5px solid #888; /* ê¸°ë³¸ ì™¼ìª½ ì„  */
        gap: 20px;
      }

      /* íƒ€ì…ë³„ ìƒ‰ìƒ ê°•ì¡° */
      .history-item.add {
        border-left-color: #2ecc71;
      }
      .history-item.move {
        border-left-color: #3498db;
      }
      .history-item.remove {
        border-left-color: #e74c3c;
      }
      .history-item.info {
        border-left-color: #f1c40f;
      }
      .history-item.reeval {
        border-left-color: #9b59b6;
      }

      /* íƒœê·¸ ë‚´ìš© ê°ì‹¸ëŠ” ì˜ì—­ */
      .tag-content {
        max-height: 500px;
        overflow: hidden;
        transition:
          max-height 0.3s ease-out,
          opacity 0.2s;
        opacity: 1;
      }
      .tag-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin-top: 0;
      }

      @media (max-width: 768px) {
        .main-container {
          padding: 10px;
          gap: 15px;
        }
        .container,
        .detail-panel,
        .detail-panel.clears-panel {
          padding: 15px;
        }
        #detailHeader {
          margin-bottom: 30px;
        }
        #headerTitle {
          font-size: 100px;
        }
        #detailSubtitle {
          font-size: 20px;
        }
        .detail-title {
          font-size: 2.8rem;
          word-break: keep-all;
        }
      }
    </style>
    <style>
      /* ëª¨ë°”ì¼ ì „ìš© ì»¨íŠ¸ë¡¤ ë° íŒ¨ë„ ì œì–´ */
      .mobile-controls {
        display: none;
        justify-content: center;
        gap: 15px;
        margin-bottom: 20px;
      }
      .mobile-toggle-btn {
        background: #444;
        color: white;
        border: 1px solid #777;
        padding: 10px 20px;
        border-radius: 8px;
        font-family: Paperlogy5;
        font-size: 1.2rem;
        cursor: pointer;
        transition: 0.2s;
      }
      .mobile-toggle-btn.active {
        background: #fff;
        color: #333;
        font-weight: bold;
      }

      @media (max-width: 768px) {
        .mobile-controls {
          display: flex;
        }
        .container,
        .detail-panel.clears-panel {
          display: none;
        }
        .container.show,
        .detail-panel.clears-panel.show {
          display: flex;
        }
        #historySection {
          margin-top: auto !important;
        }
      }
    </style>
  </head>

  <body>
    <div class="auth-bar">
      <div id="userStatus" class="user-status"></div>
      <button class="auth-btn" onclick="login()">ê³„ì • ì„ íƒ</button>
    </div>

    <div class="header-container">
      <button class="hamburger" onclick="toggleMenu()">â˜°</button
      ><a href="../index.html" class="header-btn-wrapper">
        <button class="header-btn">í™ˆ</button>
      </a>
      <a href="../level.html" class="header-btn-wrapper">
        <button class="header-btn">ë ˆë²¨</button>
      </a>
      <div class="header-btn-wrapper">
        <a href="../mappack.html" class="header-btn-wrapper">
          <button class="header-btn">ë§µ íŒ©</button>
        </a>
      </div>
      <div class="header-btn-wrapper">
        <a href="../roulette.html" class="header-btn-wrapper">
          <button class="header-btn">ë£°ë ›</button>
        </a>
      </div>
    </div>

    <div class="divider"></div>

    <div id="detailHeader">
      <div id="headerTitle">Challenge</div>
      <div id="detailSubtitle">
        ì´ˆì¹œ ë©¤ë²„ë“¤ì´ ë§Œë“  ë§µë“¤ ì¤‘ 20ì´ˆ ë¯¸ë§Œì˜ ë ˆë²¨ì„ ëª¨ì•„ë†“ì€ ê³³ì…ë‹ˆë‹¤.
      </div>
      <div style="margin-top: 70px"></div>
      <div id="detailSubtitle">&lt;ë ˆë²¨ ë¦¬ìŠ¤íŠ¸ ë°”ë¡œê°€ê¸°&gt;</div>
      <div id="modeShortcut">
        <button class="mode-btn" onclick="location.href = 'classic.html'">
          Classic
        </button>
        <button
          class="mode-btn active"
          onclick="location.href = 'challenge.html'"
        >
          Challenge
        </button>
        <button class="mode-btn" onclick="location.href = 'platformer.html'">
          Platformer
        </button>
      </div>
    </div>

    <div class="mobile-controls">
      <button
        class="mobile-toggle-btn"
        onclick="toggleMobilePanel('list', this)"
      >
        â˜° ë ˆë²¨ ëª©ë¡
      </button>
      <button
        class="mobile-toggle-btn"
        onclick="toggleMobilePanel('clears', this)"
      >
        ğŸ† ê¸°ë¡ ëª…ë‹¨
      </button>
    </div>

    <div class="main-container">
      <div class="container" id="mobileListPanel">
        <input
          id="search"
          placeholder="ì œëª© ë˜ëŠ” íƒœê·¸ ê²€ìƒ‰..."
          oninput="updateFilter()"
        />
        <div class="tag-filter-container">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div class="section-title">íƒœê·¸ í•„í„°</div>
            <button
              onclick="toggleTagPanel()"
              id="tagToggleBtn"
              style="
                background: none;
                border: 1px solid #555;
                color: #ccc;
                cursor: pointer;
                border-radius: 4px;
                padding: 2px 8px;
              "
            >
              í´ê¸°
            </button>
          </div>
          <div id="tagContent" class="tag-content collapsed">
            <div id="tagCategoryContainer"></div>
          </div>
        </div>
        <div id="list" style="overflow-y: auto"></div>
      </div>

      <div class="detail-panel">
        <div class="detail-header">
          <div id="detailTitle" class="detail-title"></div>
          <div id="detailCreator" class="detail-creator"></div>
        </div>
        <div class="video-wrapper">
          <iframe id="detailVideo" allowfullscreen></iframe>
        </div>
        <div class="detail-content">
          <div id="infoSection" class="info-section"></div>
          <div id="graphSection" class="graph-section"></div>
          <div id="detailDescription"></div>
        </div>
        <p class="fp-warning">â€» í”„ë ˆì„ í¼í™íŠ¸ëŠ” ì •í™•í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤ â€»</p>

        <div id="historySection" class="section" style="margin-top: 20px">
          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-bottom: 10px;
            "
          >
            <div class="section-title" style="margin-bottom: 0">
              ë³€ê²½ ì´ë ¥ (Level History)
            </div>
            <button
              onclick="toggleHistoryPanel()"
              id="historyToggleBtn"
              style="
                background: none;
                border: 1px solid #555;
                color: #ccc;
                cursor: pointer;
                border-radius: 4px;
                padding: 2px 8px;
              "
            >
              ì ‘ê¸°
            </button>
          </div>
          <div id="historyContentWrapper" class="history-content-wrapper">
            <div id="historyList"></div>
          </div>
        </div>
      </div>

      <div class="detail-panel clears-panel" id="mobileClearsPanel">
        <div
          style="
            font-family: Paperlogy9;
            font-size: 3.2rem;
            text-align: center;
            color: white;
          "
        >
          ê¸°ë¡ ëª…ë‹¨
        </div>
        <div id="detailClears"></div>
      </div>
    </div>

    <div id="devPanel" class="dev-panel">
      <div class="detail-header" style="margin-top: 20px">
        <div class="detail-title" style="font-size: 2.5rem">ê°œë°œì íŒ¨ë„</div>
        <div id="devContent" class="dev-content"></div>
      </div>
    </div>

    <script>
      // í˜ì´ì§€ë³„ ì„¤ì •
      const LEVEL_CONFIG = {
        jsonUrl: 'challenge.json',
        ghOwner: 'imBBBT',
        ghRepo: 'chochin-forum',
        ghPath: 'level/challenge.json',
        ghToken: '', // í•„ìš”í•œ ê²½ìš° í† í° ì…ë ¥
        filterCategories: {
          ëª¨ë“œ: [
            'Cube',
            'Ship',
            'Ball',
            'UFO',
            'Wave',
            'Robot',
            'Spider',
            'Swing',
            'Any-Mode',
          ],
          ê¸¸ì´: ['Tiny', 'Short', 'Medium', 'Long', 'XL', 'XXL', 'XXXL'],
          íŠ¹ì§•: [
            'Memory',
            'Sync',
            'Gimmick',
            'Physical',
            'Spam',
            'Learny',
            'Boss',
          ],
          ê¸°íƒ€: ['None-Effect', 'Low-Effect', 'Full-Effect', 'One-Mode'],
        },
      };
    </script>
    <script>
      /* ================= ë°ì´í„° ë° ìƒìˆ˜ ================= */
      // LEVEL_CONFIGëŠ” HTMLì—ì„œ ì •ì˜ë˜ì–´ì•¼ í•¨

      const PLAYER_YOUTUBE = {
        imBBBT: 'https://www.youtube.com/@imBBBT',
        Choco: 'https://www.youtube.com/@ì´ˆì½”5768',
        Light: 'https://www.youtube.com/@CC_Light722',
        Timo: 'https://www.youtube.com/@SNIPER_Timo',
      };

      const DEV_PASSWORD = 'tyviva123';

      let demonData = [];
      let changeHistory = [];
      let filteredData = [];
      let currentUser = localStorage.getItem('currentUser') || null;

      let githubConfig = {
        owner: LEVEL_CONFIG.ghOwner,
        repo: LEVEL_CONFIG.ghRepo,
        path: LEVEL_CONFIG.ghPath,
        token: LEVEL_CONFIG.ghToken || localStorage.getItem('gh_token') || '',
      };

      document.addEventListener('DOMContentLoaded', async function () {
        try {
          const response = await fetch(LEVEL_CONFIG.jsonUrl);
          const data = await response.json();

          demonData = data.levels || data.buttons || data || [];
          changeHistory = data.history || [];
          filteredData = [...demonData];

          if (currentUser) {
            document.getElementById('userStatus').innerText =
              `ì ‘ì† ê³„ì • : ${currentUser}`;
          }

          renderTagFilterButtons();
          generateList(filteredData);
          renderHistory();

          const urlParams = new URLSearchParams(window.location.search);
          const idParam = urlParams.get('id');
          let initialIndex = 0;

          if (idParam) {
            const foundIndex = filteredData.findIndex((d) => d.id == idParam);
            if (foundIndex !== -1) initialIndex = foundIndex;
          }

          if (filteredData.length > 0) {
            const list = document.getElementById('list');
            const targetEl = list.children[initialIndex];
            showDetail(filteredData[initialIndex], targetEl);
            if (idParam && targetEl)
              targetEl.scrollIntoView({ block: 'center' });
          }
        } catch (err) {
          console.error('JSON ë¡œë“œ ì‹¤íŒ¨ ë˜ëŠ” íŒŒì¼ ì—†ìŒ', err);
          document.getElementById('list').innerHTML =
            `<div style="color:white;text-align:center;padding:20px;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</div>`;
        }
      });

      function login() {
        const name = prompt('ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        if (!name) return;

        currentUser = name;
        localStorage.setItem('currentUser', name);
        document.getElementById('userStatus').innerText = `ì ‘ì† ê³„ì • : ${name}`;
        alert(`${name}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`);

        generateList(filteredData);
      }

      function checkIfCleared(item) {
        if (!currentUser) return false;
        const name = currentUser.toLowerCase();

        const isInClearList =
          item.clears &&
          item.clears.some((c) => c.player.toLowerCase() === name);
        const isVerifier =
          item.verifier && item.verifier.toLowerCase() === name;

        return isInClearList || isVerifier;
      }

      /* ================= ì´ˆê¸°í™” ë° ë Œë”ë§ ================= */
      function generateList(data) {
        const list = document.getElementById('list');
        list.innerHTML = '';

        if (data.length === 0) {
          list.innerHTML =
            '<div style="color:#aaa; text-align:center; margin-top:20px;">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        data.forEach((item) => {
          const isDone = checkIfCleared(item);
          const div = document.createElement('div');
          div.className = `item ${isDone ? 'cleared' : ''}`;
          div.innerHTML = `
            <div class="rank">${item.id}</div>
            <div>
              <div class="title">${item.title} ${
                isDone ? '<span class="clear-check">âœ…</span>' : ''
              }</div>
              <div class="creator">${item.creator}</div>
            </div>
          `;
          div.onclick = () => showDetail(item, div);
          list.appendChild(div);
        });
      }

      function showDetail(item, element) {
        document
          .querySelectorAll('.item')
          .forEach((el) => el.classList.remove('active'));
        if (element) element.classList.add('active');

        const clearBox = document.getElementById('detailClears');
        if (!clearBox) return;

        document.getElementById('detailTitle').textContent = item.title;
        document.getElementById('detailCreator').textContent =
          item.creator === item.verifier
            ? `by ${item.creator}`
            : `by ${item.creator} / Verified by ${item.verifier}`;

        const videoFrame = document.getElementById('detailVideo');
        if (videoFrame) {
          videoFrame.src = item.video ? item.video : 'about:blank';
        }

        const info = document.getElementById('infoSection');
        if (info) {
          info.innerHTML = '';
          if (item.map) {
            info.innerHTML = `
            <div class="info-row" style="margin-bottom: 10px; padding-bottom: 10px; border-bottom: 1px solid #555;">
              <span><b>ID:</b> ${item.map?.mapId || '-'}</span>
              <span><b>Length:</b> ${item.map?.length || '-'}</span>
              <span><b>Objects:</b> ${item.map?.objects?.toLocaleString() || '0'}</span>
              <span><b>Date:</b> ${item.map?.uploadDate || '-'}</span>
            </div>
            <div class="song-info" style="background: #333; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
              <div style="font-family: Paperlogy7; color: #fff;">ë…¸ë˜ ì •ë³´</div>
              <div style="font-size: 0.9rem; color: #eee; font-family: Paperlogy5;">
                ${item.song?.artist || 'Unknown'} - ${item.song?.name || 'Unknown'}
                <span style="color: #888;">(ID: ${item.song?.id || '-'})</span>
              </div>
            </div>
          `;
          }
        }

        const graph = document.getElementById('graphSection');
        if (graph) {
          graph.innerHTML = '';
          if (item.gameplay) {
            graph.innerHTML += makeRatioGraph(
              'ê²Œì„ëª¨ë“œ ë¹„ìœ¨',
              item.gameplay.modeRatio,
            );
            graph.innerHTML += makeRatioGraph(
              'ì†ë„ ë¹„ìœ¨',
              item.gameplay.speedRatio,
            );
          }
          if (item.framePerfect) {
            graph.innerHTML += makeRatioGraph(
              'í”„ë ˆì„ í¼í™íŠ¸',
              item.framePerfect.fps,
              '',
            );
          }
        }

        const description = document.getElementById('detailDescription');
        if (description) {
          description.innerHTML = '';
          if (item.tags?.length) {
            const tagsHtml = item.tags
              .map(
                (t) =>
                  `<span class="tag" onclick="searchByTag('${t}')">#${t}</span>`,
              )
              .join('');
            description.innerHTML = `<div class="section"><div class="section-title">íƒœê·¸</div><div class="tag-group-container">${tagsHtml}</div></div>`;
          }
        }

        clearBox.innerHTML = '';
        if (item.clears?.length) {
          item.clears.forEach((c, i) => {
            const row = document.createElement('div');
            row.className = `clear-row rank-${i + 1}`;
            const youtube =
              typeof PLAYER_YOUTUBE !== 'undefined'
                ? PLAYER_YOUTUBE[c.player]
                : null;
            const playerHTML = youtube
              ? `<a href="${youtube}" target="_blank">${c.player}</a>`
              : c.player;

            row.innerHTML = `
              <div class="clear-rank">${i + 1}</div>
              <div class="clear-player">${playerHTML}</div>
              <div class="clear-percent ${c.percent === 100 ? 'full' : ''}">${c.percent}%</div>
              <div class="clear-date">${c.date || ''}</div>
            `;
            clearBox.appendChild(row);
          });
        }

        if (typeof renderHistory === 'function') {
          renderHistory(item.title);
        }
      }

      function makeRatioGraph(title, data, suffix = '%') {
        if (!data || Object.keys(data).length === 0) return '';
        return `
          <div class="graph-box">
            <div class="graph-title">${title}</div>
            ${Object.entries(data)
              .map(
                ([k, v]) => `
              <div class="graph-row">
                <div class="graph-label">${k}</div>
                <div class="graph-bar-bg"><div class="graph-bar" data-key="${k}" style="width:${v}%"></div></div>
                <div class="graph-value">${v}${suffix}</div>
              </div>
            `,
              )
              .join('')}
          </div>
        `;
      }

      function renderTagFilterButtons() {
        const container = document.getElementById('tagCategoryContainer');
        if (!container) return;

        // LEVEL_CONFIG.filterCategories ì‚¬ìš©
        container.innerHTML = Object.entries(LEVEL_CONFIG.filterCategories)
          .map(
            ([catName, tags]) => `
          <div class="tag-cat-row">
            <div class="tag-cat-name">${catName}</div>
            <div class="tag-cat-list">
              ${tags
                .map(
                  (t) =>
                    `<button class="filter-tag-btn" onclick="searchByTag('${t}')">#${t}</button>`,
                )
                .join('')}
            </div>
          </div>
        `,
          )
          .join('');
      }

      function searchByTag(tagName) {
        const searchInput = document.getElementById('search');
        if (searchInput.value === tagName) searchInput.value = '';
        else searchInput.value = tagName;
        updateFilter();
      }

      function updateFilter() {
        const term = document
          .getElementById('search')
          .value.toLowerCase()
          .trim();
        document.querySelectorAll('.filter-tag-btn').forEach((btn) => {
          if (btn.innerText.toLowerCase() === `#${term}`)
            btn.classList.add('active');
          else btn.classList.remove('active');
        });

        filteredData = demonData.filter((item) => {
          const titleMatch = item.title.toLowerCase().includes(term);
          const tagMatch =
            item.tags &&
            item.tags.some(
              (t) => t.toLowerCase() === term || t.toLowerCase().includes(term),
            );
          return titleMatch || tagMatch;
        });

        generateList(filteredData);
        if (filteredData.length > 0) showDetail(filteredData[0]);
      }

      /* ================= ê°œë°œì íŒ¨ë„ ë¡œì§ ================= */
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'e') {
          const panel = document.getElementById('devPanel');
          if (panel.classList.contains('open')) panel.classList.remove('open');
          else if (prompt('ê°œë°œì ë¹„ë°€ë²ˆí˜¸') === DEV_PASSWORD) {
            panel.classList.add('open');
            renderDevHome();
          }
        }
      });

      function renderDevHome() {
        document.getElementById('devContent').innerHTML = `
          <button class="dev-btn" onclick="renderLevelForm()">ìƒˆ ë ˆë²¨ ë“±ë¡</button>
          <button class="dev-btn" onclick="renderEditList()">ë ˆë²¨ ìˆ˜ì • / ê¸°ë¡ ê°±ì‹ </button>
          <button class="dev-btn" onclick="renderGitHubConfig()" style="background:#8e44ad;">GitHub ì„¤ì •</button>
          <button class="dev-btn" onclick="saveToGitHub()" style="background:#2980b9;">GitHubì— ì €ì¥</button>
          <button class="dev-btn" onclick="exportJson()" style="background:#5cb85c;">JSON ë‚´ë³´ë‚´ê¸°</button>
        `;
      }

      function renderEditList() {
        let html =
          '<h3>ìˆ˜ì •í•  ë ˆë²¨ ì„ íƒ</h3><div style="max-height:300px; overflow-y:auto; background:#333; border-radius:5px;">';
        demonData.forEach((lv, idx) => {
          html += `<div class="item" style="padding:10px; border-bottom:1px solid #444;" onclick="renderLevelForm(${idx})">
                    ${lv.id}. ${lv.title}
                    </div>`;
        });
        html +=
          '</div><button class="dev-btn" onclick="renderDevHome()">ë’¤ë¡œê°€ê¸°</button>';
        document.getElementById('devContent').innerHTML = html;
      }

      function renderLevelForm(idx = null) {
        const isEdit = idx !== null;
        const lv = isEdit
          ? demonData[idx]
          : {
              title: '',
              creator: '',
              verifier: '',
              video: '',
              map: { mapId: '', length: '', objects: 0, uploadDate: '' },
              song: { name: '', artist: '', id: '' },
              gameplay: { modeRatio: {}, speedRatio: {} },
              framePerfect: { total: 0, fps: {} },
              tags: [],
            };

        const mkInput = (id, ph, val, type = 'text') =>
          `<input id="${id}" class="dev-input" type="${type}" placeholder="${ph}" value="${val || ''}">`;

        document.getElementById('devContent').innerHTML = `
          <h3>${isEdit ? 'ë ˆë²¨ ìˆ˜ì •' : 'ìƒˆ ë ˆë²¨ ë“±ë¡'}</h3>
          <div style="max-height:450px; overflow-y:auto; padding-right:10px; display:flex; flex-direction:column; gap:10px;">
          <label>ìˆœìœ„ ì„¤ì • (í˜„ì¬ ì´ ${demonData.length}ê°œ)</label>
            ${mkInput(
              'f-placement',
              `ìˆœìœ„ (1~${demonData.length + (isEdit ? 0 : 1)})`,
              isEdit ? idx + 1 : demonData.length + 1,
              'number',
            )}
              
            <label>ê¸°ë³¸: ì œëª©, ì œì‘ì, ë² ë¦¬íŒŒì´ì–´, ì˜ìƒURL</label>
            ${mkInput('f-title', 'ì œëª©', lv.title)}
            ${mkInput('f-creator', 'ì œì‘ì', lv.creator)}
            ${mkInput('f-verifier', 'ë² ë¦¬íŒŒì´ì–´', lv.verifier)}
            ${mkInput('f-video', 'ì˜ìƒ URL', lv.video)}

            <label>ë§µ: ID, ê¸¸ì´, ì˜¤ë¸Œì íŠ¸, ë‚ ì§œ</label>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:5px;">
              ${mkInput('f-mid', 'ë§µ ID', lv.map?.mapId)}
              ${mkInput('f-mlen', 'ê¸¸ì´', lv.map?.length)}
              ${mkInput('f-mobj', 'ì˜¤ë¸Œì íŠ¸', lv.map?.objects)}
              ${mkInput('f-mdate', 'ë‚ ì§œ', lv.map?.uploadDate)}
            </div>

            <label>ë…¸ë˜: ì œëª©, ì‘ê³¡ê°€, ë…¸ë˜ ID</label>
            ${mkInput('f-sname', 'ë…¸ë˜ ì œëª©', lv.song?.name)}
            ${mkInput('f-sauth', 'ì‘ê³¡ê°€', lv.song?.artist)}
            ${mkInput('f-sid', 'ë…¸ë˜ ID', lv.song?.id)}

            <label>ë¹„ìœ¨(JSON): ëª¨ë“œ, ì†ë„, í”„ë ˆì„í¼í™íŠ¸</label>
            <textarea id="f-mode" class="dev-input" placeholder='ëª¨ë“œ ë¹„ìœ¨ {"Cube":50...}' style="min-height:60px;">${JSON.stringify(
              lv.gameplay?.modeRatio || {},
            )}</textarea>
            <textarea id="f-speed" class="dev-input" placeholder='ì†ë„ ë¹„ìœ¨ {"1x":100...}' style="min-height:60px;">${JSON.stringify(
              lv.gameplay?.speedRatio || {},
            )}</textarea>
            <textarea id="f-fps" class="dev-input" placeholder='FPS {"60hz":1...}' style="min-height:60px;">${JSON.stringify(
              lv.framePerfect?.fps || {},
            )}</textarea>

            <label class="dev-label">íƒœê·¸ (ì‰¼í‘œ êµ¬ë¶„)</label>
            ${mkInput('f-tags', 'íƒœê·¸1, íƒœê·¸2', lv.tags?.join(', '))}
          </div>
          <button class="dev-btn dev-btn-save" onclick="saveLevelForm(${idx})">
        ${isEdit ? 'ìˆ˜ì • ì™„ë£Œ' : 'ë“±ë¡ ì™„ë£Œ'}
      </button>
          ${
            isEdit
              ? `<button class="dev-btn" onclick="deleteLevel(${idx})" style="background:#e74c3c;">ì‚­ì œ</button>`
              : ''
          }
          <button class="dev-btn" onclick="renderDevHome()">ì·¨ì†Œ</button>

          <label class="dev-label">ê¸°ë¡ ê´€ë¦¬ (Clears)</label>
            <div id="f-clears-container" style="display:flex; flex-direction:column; gap:5px;">
              ${(lv.clears || [])
                .map(
                  (c, i) => `
                <div class="clear-edit-row" style="display:flex; gap:3px;">
                  <input class="dev-input cl-p" placeholder="ìœ ì €" value="${c.player}" style="flex:2">
                  <input class="dev-input cl-v" placeholder="%" value="${c.percent}" style="flex:1">
                  <input class="dev-input cl-d" placeholder="ë‚ ì§œ" value="${c.date || ''}" style="flex:1.5">
                  <button onclick="this.parentElement.remove()" style="background:#e74c3c; border:none; color:white; border-radius:4px; cursor:pointer; width:30px;">X</button>
                </div>
              `,
                )
                .join('')}
            </div>
            <button class="dev-btn" onclick="addClearInputRow()" style="background:#3498db; margin-top:5px;">+ ê¸°ë¡ ì¶”ê°€</button>
            `;
      }

      function saveLevelForm(idx) {
        const isEdit = idx !== null;

        try {
          const playerInputs = document.querySelectorAll('.cl-p');
          const percentInputs = document.querySelectorAll('.cl-v');
          const dateInputs = document.querySelectorAll('.cl-d');
          const newClears = [];
          const placementInput = document.getElementById('f-placement');
          let targetRank = placementInput
            ? parseInt(placementInput.value) - 1
            : isEdit
              ? idx
              : demonData.length;

          playerInputs.forEach((input, i) => {
            const pName = input.value.trim();
            if (pName) {
              newClears.push({
                player: pName,
                percent: parseInt(percentInputs[i].value) || 100,
                date: dateInputs[i]?.value.trim() || '',
              });
            }
          });

          const getValue = (id) => document.getElementById(id)?.value || '';

          let fpsData = {};
          try {
            fpsData = JSON.parse(getValue('f-fps') || '{}');
          } catch (e) {
            alert('FPS ë°ì´í„° í˜•ì‹ ì˜¤ë¥˜');
            return;
          }

          const newData = {
            id: isEdit ? demonData[idx].id : demonData.length + 1,
            title: getValue('f-title'),
            creator: getValue('f-creator'),
            verifier: getValue('f-verifier'),
            video: getValue('f-video'),
            map: {
              mapId: getValue('f-mid'),
              length: getValue('f-mlen'),
              objects: parseInt(getValue('f-mobj')) || 0,
              uploadDate: getValue('f-mdate'),
            },
            song: {
              name: getValue('f-sname'),
              artist: getValue('f-sauth'),
              id: getValue('f-sid'),
            },
            gameplay: {
              modeRatio: JSON.parse(getValue('f-mode') || '{}'),
              speedRatio: JSON.parse(getValue('f-speed') || '{}'),
            },
            framePerfect: {
              fps: fpsData,
              total: Object.values(fpsData).reduce(
                (a, b) => a + (parseInt(b) || 0),
                0,
              ),
            },
            tags: getValue('f-tags')
              .split(',')
              .map((t) => t.trim())
              .filter((t) => t),
            clears: newClears,
          };

          if (isEdit) {
            const oldRank = idx;
            if (oldRank !== targetRank) {
              const direction = targetRank < oldRank ? 'ìƒìŠ¹' : 'í•˜ë½';
              addHistory(
                'reeval',
                newData.title,
                `'${newData.title}' ë ˆë²¨ì˜ ì¬í‰ê°€ë¡œ ì¸í•´ ìˆœìœ„ê°€ ${oldRank + 1}ìœ„ì—ì„œ ${targetRank + 1}ìœ„ë¡œ ${direction}í•˜ì˜€ìŠµë‹ˆë‹¤.`,
              );

              const start = Math.min(oldRank, targetRank);
              const end = Math.max(oldRank, targetRank);
              const shift = targetRank < oldRank ? 1 : -1;

              for (let i = start; i <= end; i++) {
                if (i === oldRank) continue;
                const affectedLv = demonData[i];
                const shiftDir = shift > 0 ? 'í•˜ë½' : 'ìƒìŠ¹';
                addHistory(
                  'move',
                  affectedLv.title,
                  `'${newData.title}' ë ˆë²¨ì˜ ìˆœìœ„ ë³€ë™ìœ¼ë¡œ ì¸í•´ ìˆœìœ„ê°€ ${i + 1}ìœ„ì—ì„œ ${i + 1 + shift}ìœ„ë¡œ ${shiftDir}í•˜ì˜€ìŠµë‹ˆë‹¤.`,
                );
              }

              demonData.splice(oldRank, 1);
              demonData.splice(targetRank, 0, newData);
            } else {
              demonData[idx] = newData;
            }
          } else {
            for (let i = targetRank; i < demonData.length; i++) {
              addHistory(
                'move',
                demonData[i].title,
                `'${newData.title}' ë ˆë²¨ ì¶”ê°€ë¡œ ì¸í•´ ìˆœìœ„ê°€ ${i + 1}ìœ„ì—ì„œ ${i + 2}ìœ„ë¡œ í•˜ë½í•˜ì˜€ìŠµë‹ˆë‹¤.`,
              );
            }

            demonData.splice(targetRank, 0, newData);
            addHistory(
              'add',
              newData.title,
              `${targetRank + 1}ìœ„ì— ìƒˆë¡œìš´ ë ˆë²¨ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`,
            );
          }

          demonData.forEach((lv, i) => {
            lv.id = i + 1;
          });

          generateList(demonData);
          alert('ì €ì¥ ì™„ë£Œ');
          renderDevHome();
        } catch (err) {
          console.error('ì €ì¥ ì¤‘ ì—ëŸ¬ ë°œìƒ:', err);
          alert('ì €ì¥ ì‹¤íŒ¨');
        }
      }

      function deleteLevel(idx) {
        if (
          !confirm(
            'ì •ë§ë¡œ ì´ ë ˆë²¨ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì‚­ì œ í›„ì—ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.',
          )
        )
          return;

        const deletedLv = demonData[idx];
        const oldRank = idx + 1;

        addHistory(
          'remove',
          deletedLv.title,
          `${oldRank}ìœ„ì— ìˆë˜ ë ˆë²¨ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,
        );

        for (let i = idx + 1; i < demonData.length; i++) {
          const affectedLv = demonData[i];
          addHistory(
            'move',
            affectedLv.title,
            `'${deletedLv.title}' ë ˆë²¨ ì‚­ì œë¡œ ì¸í•´ ìˆœìœ„ê°€ ${i + 1}ìœ„ì—ì„œ ${i}ìœ„ë¡œ ìƒìŠ¹í•˜ì˜€ìŠµë‹ˆë‹¤.`,
          );
        }

        demonData.splice(idx, 1);
        demonData.forEach((lv, i) => (lv.id = i + 1));

        generateList(demonData);
        alert('ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        renderDevHome();
      }

      function addClearInputRow() {
        const container = document.getElementById('f-clears-container');
        const div = document.createElement('div');
        div.className = 'clear-edit-row';
        div.style = 'display:flex; gap:3px;';
        div.innerHTML = `
          <input class="dev-input cl-p" placeholder="ìœ ì €" style="flex:2">
          <input class="dev-input cl-v" placeholder="%" style="flex:1">
          <input class="dev-input cl-d" placeholder="ë‚ ì§œ" style="flex:1.5">
          <button onclick="this.parentElement.remove()" style="background:#e74c3c; border:none; color:white; border-radius:4px; cursor:pointer; width:30px;">X</button>
        `;
        container.appendChild(div);
      }

      function exportJson() {
        const data = {
          levels: demonData,
          history: changeHistory,
        };

        const json = JSON.stringify(data, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        a.download = LEVEL_CONFIG.jsonUrl;
        a.click();

        URL.revokeObjectURL(url);
      }

      function renderGitHubConfig() {
        const isTokenFixed = !!LEVEL_CONFIG.ghToken;
        document.getElementById('devContent').innerHTML = `
          <h3>GitHub ì—°ë™ ì„¤ì •</h3>
          <div style="display:flex; flex-direction:column; gap:10px;">
            <label class="dev-label">Repository Owner (ê³ ì •)</label>
            <input class="dev-input" value="${githubConfig.owner}" readonly style="background:#222; color:#888;">
            
            <label class="dev-label">Repository Name (ê³ ì •)</label>
            <input class="dev-input" value="${githubConfig.repo}" readonly style="background:#222; color:#888;">
            
            <label class="dev-label">File Path (ê³ ì •)</label>
            <input class="dev-input" value="${githubConfig.path}" readonly style="background:#222; color:#888;">
            
            <label class="dev-label">Personal Access Token ${isTokenFixed ? '(ê³ ì •ë¨)' : ''}</label>
            <input id="gh-token" class="dev-input" type="password" value="${githubConfig.token}" ${
              isTokenFixed
                ? 'readonly style="background:#222; color:#888;"'
                : 'placeholder="ghp_..."'
            }>
            
            ${
              !isTokenFixed
                ? '<button class="dev-btn dev-btn-save" onclick="saveGitHubConfig()">í† í° ì €ì¥</button>'
                : ''
            }
            <button class="dev-btn" onclick="renderDevHome()">ë’¤ë¡œê°€ê¸°</button>
          </div>
        `;
      }

      function saveGitHubConfig() {
        if (!LEVEL_CONFIG.ghToken) {
          githubConfig.token = document.getElementById('gh-token').value.trim();
          localStorage.setItem('gh_token', githubConfig.token);
          alert('í† í°ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }
        renderDevHome();
      }

      async function saveToGitHub() {
        if (!githubConfig.token || !githubConfig.owner || !githubConfig.repo) {
          if (confirm('GitHub ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤. ì„¤ì • í™”ë©´ìœ¼ë¡œ ì´ë™í• ê¹Œìš”?'))
            renderGitHubConfig();
          return;
        }

        const content = JSON.stringify(
          { levels: demonData, history: changeHistory },
          null,
          2,
        );
        const url = `https://api.github.com/repos/${githubConfig.owner}/${githubConfig.repo}/contents/${githubConfig.path}`;

        try {
          let sha = null;
          const getRes = await fetch(url, {
            headers: {
              Authorization: `Bearer ${githubConfig.token}`,
              Accept: 'application/vnd.github.v3+json',
            },
          });
          if (getRes.ok) {
            const json = await getRes.json();
            sha = json.sha;
          }

          const putRes = await fetch(url, {
            method: 'PUT',
            headers: {
              Authorization: `Bearer ${githubConfig.token}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              message: `Update ${githubConfig.path} via Web`,
              content: btoa(unescape(encodeURIComponent(content))),
              sha: sha,
            }),
          });

          if (putRes.ok) alert('GitHubì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
          else {
            const err = await putRes.json();
            alert(`ì €ì¥ ì‹¤íŒ¨: ${err.message}`);
          }
        } catch (e) {
          alert(`ì˜¤ë¥˜ ë°œìƒ: ${e.message}`);
        }
      }

      function addHistory(type, levelTitle, detail) {
        const now = new Date();
        const timeStr = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(
          now.getDate(),
        ).padStart(2, '0')} ${String(now.getHours()).padStart(2, '0')}:${String(
          now.getMinutes(),
        ).padStart(2, '0')}`;

        changeHistory.unshift({
          time: timeStr,
          type,
          title: levelTitle,
          detail,
        });
      }

      function renderHistory(targetTitle = null) {
        const list = document.getElementById('historyList');
        if (!list) return;

        list.innerHTML = '';

        if (targetTitle) {
          let bestRank = 999999;
          const currentLv = demonData.find((l) => l.title === targetTitle);
          if (currentLv) {
            bestRank = currentLv.id;
          }

          const specificHistory = changeHistory.filter(
            (h) => h.title === targetTitle,
          );
          specificHistory.forEach((h) => {
            const matches = h.detail.match(/(\d+)ìœ„/g);
            if (matches) {
              matches.forEach((m) => {
                const r = parseInt(m.replace('ìœ„', ''));
                if (!isNaN(r) && r < bestRank) bestRank = r;
              });
            }
          });

          if (bestRank !== 999999) {
            const bestRankDiv = document.createElement('div');
            bestRankDiv.style =
              'background: #333; color: #ffd700; padding: 10px; border-radius: 8px; margin-bottom: 15px; text-align: center; font-family: Paperlogy7; border: 1px solid #ffd700;';
            bestRankDiv.innerHTML = `ğŸ† ìµœê³  ìˆœìœ„ : ${bestRank}ìœ„`;
            list.appendChild(bestRankDiv);
          }
        }

        const displayData = targetTitle
          ? changeHistory.filter((h) => h.title === targetTitle)
          : changeHistory;

        displayData.forEach((h) => {
          let typeClass =
            h.type === 'add'
              ? 'add'
              : h.type === 'remove'
                ? 'remove'
                : h.type === 'reeval'
                  ? 'reeval'
                  : 'move';

          const item = document.createElement('div');
          item.className = `history-item ${typeClass}`;
          item.style =
            'display: flex; gap: 15px; padding: 10px; border-bottom: 1px solid #444; color: #eee;';
          item.innerHTML = `
            <div style="color: #aaa; min-width: 100px;">${h.time.split(' ')[0]}</div>
            <div style="flex: 1;"><b style="color: #fff;">${h.title}</b> ${h.detail}</div>
          `;
          list.appendChild(item);
        });
      }

      function toggleTagPanel() {
        const content = document.getElementById('tagContent');
        const btn = document.getElementById('tagToggleBtn');
        content.classList.toggle('collapsed');
        if (content.classList.contains('collapsed')) {
          btn.textContent = 'í´ê¸°';
        } else {
          btn.textContent = 'ì ‘ê¸°';
        }
      }

      function toggleHistoryPanel() {
        const wrapper = document.getElementById('historyContentWrapper');
        const btn = document.getElementById('historyToggleBtn');
        wrapper.classList.toggle('collapsed');
        if (wrapper.classList.contains('collapsed')) {
          btn.textContent = 'í´ê¸°';
        } else {
          btn.textContent = 'ì ‘ê¸°';
        }
      }

      function toggleMobilePanel(type, btn) {
        if (type === 'list') {
          document.getElementById('mobileListPanel').classList.toggle('show');
          btn.classList.toggle('active');
        } else if (type === 'clears') {
          document.getElementById('mobileClearsPanel').classList.toggle('show');
          btn.classList.toggle('active');
        }
      }

      function toggleMenu() {
        const header = document.querySelector('.header-container');
        header.classList.toggle('open');
      }
    </script>
  </body>
</html>
